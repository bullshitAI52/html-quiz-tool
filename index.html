<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½é¢˜åº“ç³»ç»Ÿ</title>
    <style>
        :root {
            --correct-color: #4CAF50;
            --wrong-color: #f44336;
            --primary-color: #2196F3;
            --warning-color: #FF9800;
            --success-color: #4CAF50;
            --info-color: #2196F3;
            --question-font-size: 12px;
            --option-font-size: 12px;

            /* Theme Variables - Light Mode Default */
            --bg-color: #f5f5f5;
            --container-bg: #ffffff;
            --text-color: #333333;
            --border-color: #e0e0e0;
            --item-hover-bg: #e0e0e0;
            --header-bg: linear-gradient(135deg, #333, #555);
        }

        /* Dark Mode Overrides */
        .dark-mode {
            --bg-color: #121212;
            --container-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --border-color: #333333;
            --item-hover-bg: #333333;
            --header-bg: linear-gradient(135deg, #000, #222);
            --light-bg: #2d2d2d;
            /* Replaces old light-bg usage where appropriate */
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            font-size: var(--question-font-size);
            transition: background-color 0.3s, color 0.3s;
        }

        #app {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--container-bg);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            min-height: 100vh;
            box-sizing: border-box;
            transition: background-color 0.3s;
        }

        #header {
            background: var(--header-bg);
            color: white;
            padding: 7px 10px;
            border-radius: 8px 8px 0 0;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #header h1 {
            margin: 0;
            font-size: 1.2rem;
        }

        /* å…¨å±€è®¾ç½®æ  */
        #global-settings {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background-color: var(--container-bg);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        }

        #library-manager {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        #library-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .library-item {
            padding: 8px 15px;
            background-color: var(--bg-color);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .library-item:hover {
            background-color: var(--item-hover-bg);
        }

        .library-item.active {
            background-color: var(--primary-color);
            color: white;
        }

        .library-count {
            background-color: rgba(128, 128, 128, 0.3);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.8rem;
        }

        #progress-container {
            margin-bottom: 20px;
        }

        #progress-bar {
            height: 12px;
            background-color: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
            margin-top: 5px;
        }

        #progress {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), #64b5f6);
            width: 0%;
            transition: width 0.3s;
            border-radius: 6px;
        }

        #question-container {
            background-color: var(--container-bg);
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
            position: relative;
        }

        #question {
            font-size: 1.2em;
            margin-bottom: 20px;
            font-weight: bold;
            line-height: 1.5;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .question-type {
            display: inline-block;
            background-color: var(--info-color);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-left: 10px;
            vertical-align: middle;
        }

        .difficulty-tag {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-left: 10px;
            vertical-align: middle;
        }

        .difficulty-easy {
            background-color: #4CAF50;
            color: white;
        }

        .difficulty-medium {
            background-color: #FF9800;
            color: white;
        }

        .difficulty-hard {
            background-color: #f44336;
            color: white;
        }

        .option {
            display: flex;
            align-items: flex-start;
            width: 100%;
            padding: 6px 15px;
            /* é«˜åº¦ç¼©å°50% */
            margin: 4px 0;
            /* é—´è·ç¼©å°50% */
            background-color: var(--bg-color);
            border: none;
            border-left: 4px solid transparent;
            border-radius: 8px;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
        }

        .option:hover {
            background-color: var(--item-hover-bg);
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .option-letter {
            display: inline-block;
            width: 28px;
            height: 28px;
            line-height: 28px;
            text-align: center;
            background-color: var(--border-color);
            border-radius: 50%;
            margin-right: 12px;
            font-weight: bold;
            flex-shrink: 0;
            color: #555;
        }

        /* æ­£ç¡®ç­”æ¡ˆæ ·å¼ - ç»¿è‰² */
        .correct-answer {
            background-color: #e8f5e9 !important;
            border-left-color: var(--correct-color) !important;
            color: #2e7d32;
        }

        .correct-answer .option-letter {
            background-color: var(--correct-color);
            color: white;
        }

        /* ç”¨æˆ·é€‰æ‹©çš„é”™è¯¯ç­”æ¡ˆ - çº¢è‰² */
        .wrong-answer {
            background-color: #ffebee !important;
            border-left-color: var(--wrong-color) !important;
            color: #c62828;
        }

        .wrong-answer .option-letter {
            background-color: var(--wrong-color);
            color: white;
        }

        /* èƒŒé¢˜æ¨¡å¼ä¸‹çš„é€‰é¡¹æ ·å¼ */
        .back-mode-option {
            background-color: var(--container-bg);
            cursor: default;
        }

        #answer-container {
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(76, 175, 80, 0.1);
            border-radius: 8px;
            border-left: 4px solid var(--correct-color);
        }

        #explanation-container {
            margin-top: 15px;
            padding: 15px;
            background-color: rgba(33, 150, 243, 0.1);
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
        }

        .button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .button-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .button-success {
            background-color: var(--success-color);
            color: white;
        }

        .button-danger {
            background-color: var(--wrong-color);
            color: white;
        }

        .button-warning {
            background-color: var(--warning-color);
            color: white;
        }

        #navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            gap: 45px;
        }

        #nav-buttons {
            display: flex;
            gap: 45px;
        }

        #font-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #font-type-controls {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-left: 15px;
        }

        .font-type-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .font-type-label {
            font-size: 0.8rem;
            min-width: 60px;
        }

        #status-info {
            margin-bottom: 15px;
            font-size: 14px;
            /* å›ºå®šä¸º14pxï¼Œä¸å—å­—ä½“æ§åˆ¶å½±å“ */
            color: #666;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        input[type="number"] {
            padding: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            color: var(--text-color);
            border-radius: 4px;
            width: 60px;
        }

        .hidden {
            display: none;
        }

        /* å¤šé€‰é€‰ä¸­çŠ¶æ€ */
        .selected {
            background-color: rgba(255, 152, 0, 0.1) !important;
            border-left: 4px solid var(--warning-color) !important;
        }

        .selected .option-letter {
            background-color: var(--warning-color);
            color: white;
        }

        /* å­—ä½“å¤§å°æ§åˆ¶ */
        #question-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #font-size-controls {
            display: flex;
            align-items: center;
            gap: 3px;
            background-color: var(--bg-color);
            padding: 3px 6px;
            border-radius: 15px;
            font-size: 0.8rem;
        }

        #font-size-display {
            min-width: 25px;
            text-align: center;
            font-weight: bold;
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-card {
            background-color: var(--container-bg);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-card {
            background-color: var(--bg-color);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .stat-card .value {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-card.correct .value {
            color: var(--correct-color);
        }

        .stat-card.wrong .value {
            color: var(--wrong-color);
        }

        .stat-card.answered .value {
            color: var(--primary-color);
        }

        /* æ ‡ç­¾é¡µæ ·å¼ */
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 8px 16px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .tab.active {
            border-bottom-color: var(--primary-color);
            color: var(--primary-color);
            font-weight: bold;
        }

        .tab:not(.active) {
            color: var(--text-color);
            opacity: 0.7;
        }

        /* ç»ƒä¹ å’Œè€ƒè¯•æ¨¡å¼é€‰é¡¹å¡ç‰¹æ®Šæ ·å¼ */
        .tab[data-tab="practice"]:not(.active),
        .tab[data-tab="exam"]:not(.active) {
            color: #f44336;
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* é”™é¢˜åˆ—è¡¨ */
        .wrong-questions-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .wrong-question-item {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: all 0.2s;
        }

        .wrong-question-item:hover {
            background-color: var(--light-bg);
        }

        /* è€ƒè¯•æ¨¡å¼ */
        #exam-info {
            background-color: rgba(33, 150, 243, 0.1);
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #exam-score {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--primary-color);
        }

        #exam-timer {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1.1rem;
            margin-left: auto;
            margin-right: 20px;
        }

        /* è€ƒè¯•æ¨¡å¼é¢˜ç›®å®¹å™¨ */
        #exam-question-container {
            background-color: var(--container-bg);
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
            position: relative;
        }

        #exam-question {
            font-size: 1.2em;
            margin-bottom: 20px;
            font-weight: bold;
            line-height: 1.5;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        /* è€ƒè¯•æ¨¡å¼æ§åˆ¶æŒ‰é’® */
        #exam-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* è€ƒè¯•æ¨¡å¼é€‰ä¸­çŠ¶æ€ */
        .exam-selected {
            background-color: rgba(76, 175, 80, 0.1) !important;
            border-left: 4px solid var(--correct-color) !important;
        }

        .exam-selected .option-letter {
            background-color: var(--correct-color);
            color: white;
        }

        /* è€ƒè¯•æ¨¡å¼å’Œç»ƒä¹ æ¨¡å¼å¸ƒå±€ */
        #exam-layout,
        #practice-layout,
        #practice-wrong-layout,
        #exam-wrong-layout {
            display: flex;
            gap: 20px;
        }

        #exam-sidebar,
        #practice-sidebar,
        #practice-wrong-sidebar,
        #exam-wrong-sidebar {
            width: 190px;
            /* æ”¾å¤§25% */
            background-color: var(--container-bg);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            height: 600px;
            overflow-y: auto;
        }

        #exam-content,
        #practice-content,
        #practice-wrong-content,
        #exam-wrong-content {
            flex: 1;
            min-width: 0;
        }

        .question-section {
            margin-bottom: 20px;
        }

        .section-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 5px;
            font-size: 0.9rem;
        }

        .question-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(30px, 1fr));
            /* æ”¾å¤§25% */
            gap: 5px;
        }

        .question-number {
            width: 30px;
            /* æ”¾å¤§25% */
            height: 30px;
            /* æ”¾å¤§25% */
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--bg-color);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
            font-size: 0.8rem;
            color: var(--text-color);
        }

        .question-number:hover {
            background-color: var(--item-hover-bg);
        }

        .question-number.current {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .question-number.answered {
            background-color: var(--correct-color);
            color: white;
            border-color: var(--correct-color);
        }

        .question-number.wrong {
            background-color: var(--wrong-color);
            color: white;
            border-color: var(--wrong-color);
        }

        /* ç»ƒä¹ æ¨¡å¼å¯¼èˆª */
        #practice-nav {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: var(--container-bg);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        }

        #exam-navigation,
        #practice-wrong-navigation,
        #exam-wrong-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        /* é”™é¢˜åº“é¢˜å¹²åŠ ç²— */
        #practice-wrong-question,
        #exam-wrong-question {
            font-weight: bold;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1024px) {
            #app {
                padding: 15px;
            }

            #exam-layout,
            #practice-layout,
            #practice-wrong-layout,
            #exam-wrong-layout {
                flex-direction: column;
            }

            #exam-sidebar,
            #practice-sidebar,
            #practice-wrong-sidebar,
            #exam-wrong-sidebar {
                width: 100%;
                height: auto;
                max-height: 300px;
                order: 2;
            }

            #exam-content,
            #practice-content,
            #practice-wrong-content,
            #exam-wrong-content {
                order: 1;
            }

            #global-settings {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .tabs {
                overflow-x: auto;
            }
        }

        @media (max-width: 768px) {
            #app {
                padding: 10px;
            }

            #header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .button {
                width: 100%;
            }

            #navigation {
                flex-direction: column;
                gap: 10px;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            #question-controls,
            #exam-controls {
                position: static;
                margin-bottom: 15px;
                justify-content: flex-end;
            }

            .question-grid {
                grid-template-columns: repeat(auto-fill, minmax(25px, 1fr));
            }

            .question-number {
                width: 25px;
                height: 25px;
                font-size: 0.7rem;
            }
        }

        @media (max-width: 480px) {
            .tab {
                padding: 6px 12px;
                font-size: 0.8rem;
            }

            #library-manager {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }

            #navigation {
                gap: 30px;
            }
        }
    </style>
</head>

<body>
    <div id="app">
        <div id="header">
            <h1>æ™ºèƒ½é¢˜åº“ç³»ç»Ÿ</h1>
        </div>

        <!-- å…¨å±€è®¾ç½®æ  -->
        <div id="global-settings">
            <div id="library-manager">
                <button id="modeButton" class="button button-warning">åˆ‡æ¢åˆ°èƒŒé¢˜æ¨¡å¼</button>
                <input type="file" id="fileInput" class="hidden" accept=".xlsx,.xls">
                <button id="importButton" class="button button-success">å¯¼å…¥æ–°é¢˜åº“</button>
                <button id="deleteLibraryButton" class="button button-danger">åˆ é™¤å½“å‰é¢˜åº“</button>
                <button id="resetLibraryButton" class="button button-warning">é‡ç½®é¢˜åº“</button>
                <div id="font-size-controls">
                    <button id="decrease-font" class="button button-primary">-</button>
                    <span id="font-size-display">12px</span>
                    <button id="increase-font" class="button button-primary">+</button>
                </div>
                <button id="themeToggle" class="button"
                    style="background-color: #333; color: white; margin-left: 10px;">ğŸŒ™ æ·±å¤œæ¨¡å¼</button>

                <div id="library-list"></div>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" data-tab="practice">ç»ƒä¹ æ¨¡å¼</div>
            <div class="tab" data-tab="practice-wrong">ç»ƒä¹ é”™é¢˜åº“</div>
            <div class="tab" data-tab="exam">è€ƒè¯•æ¨¡å¼</div>
            <div class="tab" data-tab="exam-wrong">è€ƒè¯•é”™é¢˜åº“</div>
            <div class="tab" data-tab="exam-stats">è€ƒè¯•ç»Ÿè®¡</div>
        </div>

        <div class="tab-content active" id="practice-tab">
            <div id="practice-layout">
                <div id="practice-sidebar">
                    <div class="question-section">
                        <div class="section-title">å•é€‰é¢˜</div>
                        <div class="question-grid" id="practice-single-grid">
                            <!-- å•é€‰é¢˜æ•°å­—æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    <div class="question-section">
                        <div class="section-title">å¤šé€‰é¢˜</div>
                        <div class="question-grid" id="practice-multi-grid">
                            <!-- å¤šé€‰é¢˜æ•°å­—æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    <div class="question-section">
                        <div class="section-title">åˆ¤æ–­é¢˜</div>
                        <div class="question-grid" id="practice-judge-grid">
                            <!-- åˆ¤æ–­é¢˜æ•°å­—æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>

                <div id="practice-content">
                    <div id="progress-container">
                        <div id="status-info"></div>
                        <div id="progress-bar">
                            <div id="progress"></div>
                        </div>
                    </div>

                    <div id="question-container">
                        <div id="question"></div>
                        <div id="options"></div>
                        <div id="answer-result" style="margin-top: 20px;"></div>

                        <div id="answer-container" class="hidden">
                            <strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong><span id="correct-answer"></span>
                        </div>

                        <div id="explanation-container" class="hidden">
                            <strong>è§£æï¼š</strong><span id="explanation"></span>
                        </div>
                    </div>

                    <div id="navigation">
                        <div id="nav-buttons">
                            <button id="prevButton" class="button button-primary">ä¸Šä¸€é¢˜</button>
                            <button id="nextButton" class="button button-primary">ä¸‹ä¸€é¢˜</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="exam-tab">
            <div id="exam-info">
                <div>
                    <strong>è€ƒè¯•æ¨¡å¼</strong> - å•é€‰é¢˜0.5åˆ†(100é¢˜) | å¤šé€‰é¢˜1åˆ†(20é¢˜) | åˆ¤æ–­é¢˜1åˆ†(30é¢˜) | æ€»åˆ†100åˆ† | 60åˆ†åŠæ ¼
                </div>
                <div id="exam-timer">å‰©ä½™æ—¶é—´: 90:00</div>
                <div id="exam-score">å¾—åˆ†: <span id="current-score">0</span></div>
            </div>

            <div id="exam-start-container" class="stats-card" style="text-align: center;">
                <h3>è€ƒè¯•æ¨¡å¼</h3>
                <p>è€ƒè¯•æ—¶é—´: 90åˆ†é’Ÿ</p>
                <p>æ€»åˆ†: 100åˆ† | åŠæ ¼: 60åˆ†</p>
                <button id="start-exam" class="button button-success">å¼€å§‹è€ƒè¯•</button>
            </div>

            <div id="exam-layout" class="hidden">
                <div id="exam-sidebar">
                    <div class="question-section">
                        <div class="section-title">å•é€‰é¢˜ (1-100)</div>
                        <div class="question-grid" id="single-choice-grid">
                            <!-- å•é€‰é¢˜æ•°å­—æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    <div class="question-section">
                        <div class="section-title">å¤šé€‰é¢˜ (101-120)</div>
                        <div class="question-grid" id="multi-choice-grid">
                            <!-- å¤šé€‰é¢˜æ•°å­—æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    <div class="question-section">
                        <div class="section-title">åˆ¤æ–­é¢˜ (121-150)</div>
                        <div class="question-grid" id="judge-grid">
                            <!-- åˆ¤æ–­é¢˜æ•°å­—æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>

                <div id="exam-content">
                    <div id="exam-progress-container">
                        <div id="exam-status-info"></div>
                        <div id="exam-progress-bar">
                            <div id="exam-progress"></div>
                        </div>
                    </div>

                    <div id="exam-question-container">
                        <!-- å·²åˆ é™¤å­—ä½“æ§åˆ¶æŒ‰é’® -->
                        <div id="exam-question"></div>
                        <div id="exam-options"></div>
                        <div id="exam-answer-result" style="margin-top: 20px;"></div>
                    </div>

                    <div id="exam-navigation">
                        <div>
                            <button id="exam-prevButton" class="button button-primary">ä¸Šä¸€é¢˜</button>
                            <span style="display:inline-block; width: 45px;"></span>
                            <button id="exam-nextButton" class="button button-primary">ä¸‹ä¸€é¢˜</button>
                        </div>
                        <button id="submit-exam" class="button button-success">æäº¤è€ƒè¯•</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="exam-stats-tab">
            <div class="stats-card">
                <h3>è€ƒè¯•å†å²è®°å½•</h3>
                <div id="exam-history-list">
                    <!-- è€ƒè¯•å†å²è®°å½•å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <div class="tab-content" id="practice-wrong-tab">
            <div id="practice-wrong-layout">
                <div id="practice-wrong-sidebar">
                    <div class="question-section">
                        <div class="section-title">å•é€‰é¢˜</div>
                        <div class="question-grid" id="practice-wrong-single-grid">
                            <!-- å•é€‰é¢˜æ•°å­—æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    <div class="question-section">
                        <div class="section-title">å¤šé€‰é¢˜</div>
                        <div class="question-grid" id="practice-wrong-multi-grid">
                            <!-- å¤šé€‰é¢˜æ•°å­—æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    <div class="question-section">
                        <div class="section-title">åˆ¤æ–­é¢˜</div>
                        <div class="question-grid" id="practice-wrong-judge-grid">
                            <!-- åˆ¤æ–­é¢˜æ•°å­—æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>

                <div id="practice-wrong-content">
                    <div id="practice-wrong-progress-container">
                        <div id="practice-wrong-status-info"></div>
                        <div id="practice-wrong-progress-bar">
                            <div id="practice-wrong-progress"></div>
                        </div>
                    </div>

                    <div id="practice-wrong-question-container">
                        <div id="practice-wrong-question-controls">
                            <button id="practice-wrong-modeButton" class="button button-warning">åˆ‡æ¢åˆ°èƒŒé¢˜æ¨¡å¼</button>
                        </div>
                        <div id="practice-wrong-question"></div>
                        <div id="practice-wrong-options"></div>
                        <div id="practice-wrong-answer-result" style="margin-top: 20px;"></div>

                        <div id="practice-wrong-answer-container" class="hidden">
                            <strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong><span id="practice-wrong-correct-answer"></span>
                        </div>

                        <div id="practice-wrong-explanation-container" class="hidden">
                            <strong>è§£æï¼š</strong><span id="practice-wrong-explanation"></span>
                        </div>
                    </div>

                    <div id="practice-wrong-navigation">
                        <div id="practice-wrong-nav-buttons">
                            <button id="practice-wrong-prevButton" class="button button-primary">ä¸Šä¸€é¢˜</button>
                            <button id="practice-wrong-nextButton" class="button button-primary">ä¸‹ä¸€é¢˜</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="exam-wrong-tab">
            <div id="exam-wrong-layout">
                <div id="exam-wrong-sidebar">
                    <div class="question-section">
                        <div class="section-title">å•é€‰é¢˜</div>
                        <div class="question-grid" id="exam-wrong-single-grid">
                            <!-- å•é€‰é¢˜æ•°å­—æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    <div class="question-section">
                        <div class="section-title">å¤šé€‰é¢˜</div>
                        <div class="question-grid" id="exam-wrong-multi-grid">
                            <!-- å¤šé€‰é¢˜æ•°å­—æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    <div class="question-section">
                        <div class="section-title">åˆ¤æ–­é¢˜</div>
                        <div class="question-grid" id="exam-wrong-judge-grid">
                            <!-- åˆ¤æ–­é¢˜æ•°å­—æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>

                <div id="exam-wrong-content">
                    <div id="exam-wrong-progress-container">
                        <div id="exam-wrong-status-info"></div>
                        <div id="exam-wrong-progress-bar">
                            <div id="exam-wrong-progress"></div>
                        </div>
                    </div>

                    <div id="exam-wrong-question-container">
                        <div id="exam-wrong-question-controls">
                            <button id="exam-wrong-modeButton" class="button button-warning">åˆ‡æ¢åˆ°èƒŒé¢˜æ¨¡å¼</button>
                        </div>
                        <div id="exam-wrong-question"></div>
                        <div id="exam-wrong-options"></div>
                        <div id="exam-wrong-answer-result" style="margin-top: 20px;"></div>

                        <div id="exam-wrong-answer-container" class="hidden">
                            <strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong><span id="exam-wrong-correct-answer"></span>
                        </div>

                        <div id="exam-wrong-explanation-container" class="hidden">
                            <strong>è§£æï¼š</strong><span id="exam-wrong-explanation"></span>
                        </div>
                    </div>

                    <div id="exam-wrong-navigation">
                        <div id="exam-wrong-nav-buttons">
                            <button id="exam-wrong-prevButton" class="button button-primary">ä¸Šä¸€é¢˜</button>
                            <button id="exam-wrong-nextButton" class="button button-primary">ä¸‹ä¸€é¢˜</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // é¢˜åº“åº”ç”¨
        const quizApp = {
            data: {
                libraries: [],
                currentLibraryIndex: 0,
                currentIndex: 0,
                mode: 'practice',
                isShuffled: false,
                currentTab: 'practice',
                examMode: false,
                examScore: 0,
                examAnswers: {},
                examQuestions: [],
                examHistory: [],
                practiceQuestions: [],
                practiceAnswers: {},
                questionFontSize: 12, // é¢˜ç›®å­—ä½“å¤§å°
                optionFontSize: 12,   // é€‰é¡¹å­—ä½“å¤§å°
                isDarkMode: false,    // æ˜¯å¦ä¸ºæ·±å¤œæ¨¡å¼
                examTimeLeft: 90 * 60, // 90åˆ†é’Ÿï¼Œä»¥ç§’ä¸ºå•ä½
                examTimer: null,
                questionOrders: {
                    single: 'sequential',
                    multi: 'sequential',
                    judge: 'sequential'
                },
                examStarted: false,

                // ç»ƒä¹ é”™é¢˜åº“æ•°æ®
                practiceWrongQuestions: [],
                practiceWrongCurrentIndex: 0,
                practiceWrongMode: 'practice', // ç»ƒä¹ é”™é¢˜åº“æ¨¡å¼ï¼špractice æˆ– back

                // è€ƒè¯•é”™é¢˜åº“æ•°æ®
                examWrongQuestions: [],
                examWrongCurrentIndex: 0,
                examWrongMode: 'practice', // è€ƒè¯•é”™é¢˜åº“æ¨¡å¼ï¼špractice æˆ– back

                // é¢˜ç›®ç»ƒä¹ æ¬¡æ•°è®°å½•
                questionPracticeCounts: {},
                correctCounts: {},

                // é”™é¢˜åº“å¤šé€‰é¢˜é€‰ä¸­çŠ¶æ€ - ç”¨äºä¸´æ—¶å­˜å‚¨å½“å‰é¢˜ç›®çš„é€‰æ‹©çŠ¶æ€
                practiceWrongMultiSelectAnswers: {},
                examWrongMultiSelectAnswers: {}
            },

            // åˆå§‹åŒ–åº”ç”¨
            init() {
                this.loadFromStorage();
                this.setupEventListeners();
                this.setupTabs();
                this.updateFontSizes();
                this.setupTheme();
                this.updateUI();

                // æ·»åŠ é¡µé¢ç¦»å¼€ç¡®è®¤
                window.addEventListener('beforeunload', (e) => {
                    if (this.data.examStarted) {
                        e.preventDefault();
                        e.returnValue = 'æ‚¨æ­£åœ¨è¿›è¡Œè€ƒè¯•ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ';
                    }
                });
            },

            // è®¾ç½®æ ‡ç­¾é¡µ
            setupTabs() {
                const tabs = document.querySelectorAll('.tab');
                tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        const tabName = tab.getAttribute('data-tab');
                        this.switchTab(tabName);
                    });
                });
            },

            // åˆ‡æ¢æ ‡ç­¾é¡µ
            switchTab(tabName) {
                // å¦‚æœæ­£åœ¨è€ƒè¯•ï¼Œæç¤ºç”¨æˆ·
                if (this.data.examStarted && tabName !== 'exam') {
                    if (confirm('æ‚¨æ­£åœ¨è¿›è¡Œè€ƒè¯•ï¼Œç¡®å®šè¦ç¦»å¼€è€ƒè¯•é¡µé¢å—ï¼Ÿ')) {
                        // å¼ºåˆ¶æäº¤è€ƒè¯•
                        this.submitExam();
                        // ç¦»å¼€è€ƒè¯•æ¨¡å¼é¡µé¢
                        this.exitExamMode();
                        this.switchTab(tabName);
                    }
                    return;
                }

                document.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });

                document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
                document.getElementById(`${tabName}-tab`).classList.add('active');

                this.data.currentTab = tabName;

                // æ›´æ–°ç‰¹å®šæ ‡ç­¾é¡µå†…å®¹
                if (tabName === 'exam-stats') {
                    this.updateExamStats();
                } else if (tabName === 'practice-wrong') {
                    this.updatePracticeWrongQuestions();
                    this.generatePracticeWrongQuestions();
                    this.updatePracticeWrongUI();
                } else if (tabName === 'exam-wrong') {
                    this.updateExamWrongQuestions();
                    this.generateExamWrongQuestions();
                    this.updateExamWrongUI();
                } else if (tabName === 'exam') {
                    if (!this.data.examStarted) {
                        document.getElementById('exam-start-container').classList.remove('hidden');
                        document.getElementById('exam-layout').classList.add('hidden');
                    } else {
                        document.getElementById('exam-start-container').classList.add('hidden');
                        document.getElementById('exam-layout').classList.remove('hidden');
                    }
                } else if (tabName === 'practice') {
                    this.exitExamMode();
                    this.generatePracticeQuestions();
                    this.updateUI();
                }
            },

            // ç”Ÿæˆç»ƒä¹ é¢˜ç›®
            generatePracticeQuestions() {
                const library = this.getCurrentLibrary();
                if (library.questions.length === 0) {
                    this.data.practiceQuestions = [];
                    return;
                }

                // æŒ‰ç±»å‹åˆ†ç±»é¢˜ç›®
                const singleChoiceQuestions = library.questions.filter(q => q.ç±»å‹ === 'å•é€‰');
                const multiChoiceQuestions = library.questions.filter(q => q.ç±»å‹ === 'å¤šé€‰');
                const judgeQuestions = library.questions.filter(q => q.ç±»å‹ === 'åˆ¤æ–­');

                // æ ¹æ®å„é¢˜å‹çš„é¡ºåºè®¾ç½®ç”Ÿæˆé¢˜ç›®
                let singleQuestions = [...singleChoiceQuestions];
                let multiQuestions = [...multiChoiceQuestions];
                let judgeQuestionsArr = [...judgeQuestions];

                if (this.data.questionOrders.single === 'shuffled') {
                    singleQuestions = this.shuffleArray([...singleQuestions]);
                }

                if (this.data.questionOrders.multi === 'shuffled') {
                    multiQuestions = this.shuffleArray([...multiQuestions]);
                }

                if (this.data.questionOrders.judge === 'shuffled') {
                    judgeQuestionsArr = this.shuffleArray([...judgeQuestionsArr]);
                }

                this.data.practiceQuestions = [
                    ...singleQuestions,
                    ...multiQuestions,
                    ...judgeQuestionsArr
                ];

                this.data.currentIndex = 0;
                this.updatePracticeSidebar();
            },

            // æ›´æ–°ç»ƒä¹ ä¾§è¾¹æ 
            updatePracticeSidebar() {
                const library = this.getCurrentLibrary();
                const singleQuestions = library.questions.filter(q => q.ç±»å‹ === 'å•é€‰');
                const multiQuestions = library.questions.filter(q => q.ç±»å‹ === 'å¤šé€‰');
                const judgeQuestions = library.questions.filter(q => q.ç±»å‹ === 'åˆ¤æ–­');

                // å•é€‰é¢˜ç½‘æ ¼ - æ˜¾ç¤ºå•é€‰é¢˜å®é™…æ•°é‡
                const singleGrid = document.getElementById('practice-single-grid');
                singleGrid.innerHTML = '';
                singleQuestions.forEach((_, index) => {
                    const numberBtn = document.createElement('div');
                    numberBtn.className = 'question-number';
                    numberBtn.textContent = index + 1;
                    numberBtn.addEventListener('click', () => {
                        this.data.currentIndex = index;
                        this.updateUI();
                    });
                    singleGrid.appendChild(numberBtn);
                });

                // å¤šé€‰é¢˜ç½‘æ ¼ - æ˜¾ç¤ºå¤šé€‰é¢˜å®é™…æ•°é‡
                const multiGrid = document.getElementById('practice-multi-grid');
                multiGrid.innerHTML = '';
                multiQuestions.forEach((_, index) => {
                    const numberBtn = document.createElement('div');
                    numberBtn.className = 'question-number';
                    numberBtn.textContent = index + 1;
                    numberBtn.addEventListener('click', () => {
                        this.data.currentIndex = singleQuestions.length + index;
                        this.updateUI();
                    });
                    multiGrid.appendChild(numberBtn);
                });

                // åˆ¤æ–­é¢˜ç½‘æ ¼ - æ˜¾ç¤ºåˆ¤æ–­é¢˜å®é™…æ•°é‡
                const judgeGrid = document.getElementById('practice-judge-grid');
                judgeGrid.innerHTML = '';
                judgeQuestions.forEach((_, index) => {
                    const numberBtn = document.createElement('div');
                    numberBtn.className = 'question-number';
                    numberBtn.textContent = index + 1;
                    numberBtn.addEventListener('click', () => {
                        this.data.currentIndex = singleQuestions.length + multiQuestions.length + index;
                        this.updateUI();
                    });
                    judgeGrid.appendChild(numberBtn);
                });

                this.updatePracticeQuestionNumberStyles();
            },

            // æ›´æ–°ç»ƒä¹ é¢˜ç›®æ•°å­—æ ·å¼
            updatePracticeQuestionNumberStyles() {
                const allNumbers = document.querySelectorAll('#practice-sidebar .question-number');
                allNumbers.forEach((number, index) => {
                    number.classList.remove('current', 'answered', 'wrong');

                    // å½“å‰é¢˜ç›®
                    if (index === this.data.currentIndex) {
                        number.classList.add('current');
                    }

                    // å·²ç­”é¢˜ç›®æ ‡è®°
                    const library = this.getCurrentLibrary();
                    if (library.userAnswers[index] && library.userAnswers[index].isSubmitted) {
                        if (library.userAnswers[index].isCorrect) {
                            number.classList.add('answered');
                        } else {
                            number.classList.add('wrong');
                        }
                    }
                });
            },

            // ç”Ÿæˆç»ƒä¹ é”™é¢˜åº“é¢˜ç›®
            generatePracticeWrongQuestions() {
                const library = this.getCurrentLibrary();
                if (library.questions.length === 0) {
                    this.data.practiceWrongQuestions = [];
                    return;
                }

                // æ”¶é›†æ‰€æœ‰ç»ƒä¹ é”™é¢˜
                const practiceWrongQuestions = [];
                library.questions.forEach((question, index) => {
                    const userAnswer = library.userAnswers[index];
                    if (userAnswer && userAnswer.isSubmitted && !userAnswer.isCorrect) {
                        practiceWrongQuestions.push({
                            ...question,
                            originalIndex: index,
                            userAnswer: userAnswer
                        });
                    }
                });

                this.data.practiceWrongQuestions = practiceWrongQuestions;
                this.data.practiceWrongCurrentIndex = 0;
                this.updatePracticeWrongSidebar();
            },

            // æ›´æ–°ç»ƒä¹ é”™é¢˜åº“ä¾§è¾¹æ 
            updatePracticeWrongSidebar() {
                const practiceWrongQuestions = this.data.practiceWrongQuestions;
                const singleQuestions = practiceWrongQuestions.filter(q => q.ç±»å‹ === 'å•é€‰');
                const multiQuestions = practiceWrongQuestions.filter(q => q.ç±»å‹ === 'å¤šé€‰');
                const judgeQuestions = practiceWrongQuestions.filter(q => q.ç±»å‹ === 'åˆ¤æ–­');

                // å•é€‰é¢˜ç½‘æ ¼
                const singleGrid = document.getElementById('practice-wrong-single-grid');
                singleGrid.innerHTML = '';
                singleQuestions.forEach((_, index) => {
                    const numberBtn = document.createElement('div');
                    numberBtn.className = 'question-number';
                    numberBtn.textContent = index + 1;
                    numberBtn.addEventListener('click', () => {
                        this.data.practiceWrongCurrentIndex = index;
                        this.updatePracticeWrongUI();
                    });
                    singleGrid.appendChild(numberBtn);
                });

                // å¤šé€‰é¢˜ç½‘æ ¼
                const multiGrid = document.getElementById('practice-wrong-multi-grid');
                multiGrid.innerHTML = '';
                multiQuestions.forEach((_, index) => {
                    const numberBtn = document.createElement('div');
                    numberBtn.className = 'question-number';
                    numberBtn.textContent = index + 1;
                    numberBtn.addEventListener('click', () => {
                        this.data.practiceWrongCurrentIndex = singleQuestions.length + index;
                        this.updatePracticeWrongUI();
                    });
                    multiGrid.appendChild(numberBtn);
                });

                // åˆ¤æ–­é¢˜ç½‘æ ¼
                const judgeGrid = document.getElementById('practice-wrong-judge-grid');
                judgeGrid.innerHTML = '';
                judgeQuestions.forEach((_, index) => {
                    const numberBtn = document.createElement('div');
                    numberBtn.className = 'question-number';
                    numberBtn.textContent = index + 1;
                    numberBtn.addEventListener('click', () => {
                        this.data.practiceWrongCurrentIndex = singleQuestions.length + multiQuestions.length + index;
                        this.updatePracticeWrongUI();
                    });
                    judgeGrid.appendChild(numberBtn);
                });

                this.updatePracticeWrongQuestionNumberStyles();
            },

            // æ›´æ–°ç»ƒä¹ é”™é¢˜åº“é¢˜ç›®æ•°å­—æ ·å¼ - ä¿®å¤ï¼šå–æ¶ˆçº¢è‰²åº•çº¹
            updatePracticeWrongQuestionNumberStyles() {
                const allNumbers = document.querySelectorAll('#practice-wrong-sidebar .question-number');
                allNumbers.forEach((number, index) => {
                    number.classList.remove('current', 'answered', 'wrong');

                    // å½“å‰é¢˜ç›®
                    if (index === this.data.practiceWrongCurrentIndex) {
                        number.classList.add('current');
                    }

                    // é”™é¢˜åº“ä¸­ä¸æ˜¾ç¤ºçº¢è‰²åº•çº¹ï¼Œåªæ˜¾ç¤ºå½“å‰é¢˜ç›®çŠ¶æ€
                });
            },

            // ç”Ÿæˆè€ƒè¯•é”™é¢˜åº“é¢˜ç›® - ä¿®å¤åçš„é€»è¾‘
            generateExamWrongQuestions() {
                const library = this.getCurrentLibrary();
                if (library.questions.length === 0) {
                    this.data.examWrongQuestions = [];
                    return;
                }

                // æ”¶é›†æ‰€æœ‰è€ƒè¯•é”™é¢˜ - ä¿®æ­£æ•°æ®ç»“æ„
                const examWrongQuestions = [];

                // æ·»åŠ è€ƒè¯•æ¨¡å¼ä¸­çš„é”™é¢˜
                this.data.examHistory.forEach(record => {
                    if (record.wrongQuestions) {
                        record.wrongQuestions.forEach(wrongQuestion => {
                            // æ‰¾åˆ°é¢˜ç›®åœ¨åŸå§‹é¢˜åº“ä¸­çš„ç´¢å¼•
                            const originalIndex = library.questions.findIndex(q => q.é¢˜å¹² === wrongQuestion.é¢˜å¹²);
                            if (originalIndex !== -1) {
                                // ä½¿ç”¨åŸå§‹é¢˜åº“ä¸­çš„å®Œæ•´é¢˜ç›®æ•°æ®ï¼Œè€Œä¸æ˜¯è€ƒè¯•ä¸­çš„é¢˜ç›®æ•°æ®
                                const originalQuestion = library.questions[originalIndex];
                                examWrongQuestions.push({
                                    ...originalQuestion,
                                    originalIndex: originalIndex,
                                    examDate: record.date,
                                    // æ·»åŠ ç”¨æˆ·ç­”æ¡ˆè®°å½•ï¼Œç”¨äºé‡æ–°ç»ƒä¹ 
                                    userAnswer: wrongQuestion.userAnswer
                                });
                            }
                        });
                    }
                });

                // å»é‡
                const uniqueExamWrongQuestions = [];
                const seen = new Set();
                examWrongQuestions.forEach(wrong => {
                    const key = `${wrong.originalIndex}-${wrong.é¢˜å¹²}`;
                    if (!seen.has(key)) {
                        seen.add(key);
                        uniqueExamWrongQuestions.push(wrong);
                    }
                });

                this.data.examWrongQuestions = uniqueExamWrongQuestions;
                this.data.examWrongCurrentIndex = 0;
                this.updateExamWrongSidebar();
            },

            // æ›´æ–°è€ƒè¯•é”™é¢˜åº“ä¾§è¾¹æ 
            updateExamWrongSidebar() {
                const examWrongQuestions = this.data.examWrongQuestions;
                const singleQuestions = examWrongQuestions.filter(q => q.ç±»å‹ === 'å•é€‰');
                const multiQuestions = examWrongQuestions.filter(q => q.ç±»å‹ === 'å¤šé€‰');
                const judgeQuestions = examWrongQuestions.filter(q => q.ç±»å‹ === 'åˆ¤æ–­');

                // å•é€‰é¢˜ç½‘æ ¼
                const singleGrid = document.getElementById('exam-wrong-single-grid');
                singleGrid.innerHTML = '';
                singleQuestions.forEach((_, index) => {
                    const numberBtn = document.createElement('div');
                    numberBtn.className = 'question-number';
                    numberBtn.textContent = index + 1;
                    numberBtn.addEventListener('click', () => {
                        this.data.examWrongCurrentIndex = index;
                        this.updateExamWrongUI();
                    });
                    singleGrid.appendChild(numberBtn);
                });

                // å¤šé€‰é¢˜ç½‘æ ¼
                const multiGrid = document.getElementById('exam-wrong-multi-grid');
                multiGrid.innerHTML = '';
                multiQuestions.forEach((_, index) => {
                    const numberBtn = document.createElement('div');
                    numberBtn.className = 'question-number';
                    numberBtn.textContent = index + 1;
                    numberBtn.addEventListener('click', () => {
                        this.data.examWrongCurrentIndex = singleQuestions.length + index;
                        this.updateExamWrongUI();
                    });
                    multiGrid.appendChild(numberBtn);
                });

                // åˆ¤æ–­é¢˜ç½‘æ ¼
                const judgeGrid = document.getElementById('exam-wrong-judge-grid');
                judgeGrid.innerHTML = '';
                judgeQuestions.forEach((_, index) => {
                    const numberBtn = document.createElement('div');
                    numberBtn.className = 'question-number';
                    numberBtn.textContent = index + 1;
                    numberBtn.addEventListener('click', () => {
                        this.data.examWrongCurrentIndex = singleQuestions.length + multiQuestions.length + index;
                        this.updateExamWrongUI();
                    });
                    judgeGrid.appendChild(numberBtn);
                });

                this.updateExamWrongQuestionNumberStyles();
            },

            // æ›´æ–°è€ƒè¯•é”™é¢˜åº“é¢˜ç›®æ•°å­—æ ·å¼ - ä¿®å¤ï¼šå–æ¶ˆçº¢è‰²åº•çº¹
            updateExamWrongQuestionNumberStyles() {
                const allNumbers = document.querySelectorAll('#exam-wrong-sidebar .question-number');
                allNumbers.forEach((number, index) => {
                    number.classList.remove('current', 'answered', 'wrong');

                    // å½“å‰é¢˜ç›®
                    if (index === this.data.examWrongCurrentIndex) {
                        number.classList.add('current');
                    }

                    // é”™é¢˜åº“ä¸­ä¸æ˜¾ç¤ºçº¢è‰²åº•çº¹ï¼Œåªæ˜¾ç¤ºå½“å‰é¢˜ç›®çŠ¶æ€
                });
            },

            // è¿›å…¥è€ƒè¯•æ¨¡å¼
            enterExamMode() {
                this.data.examMode = true;
                this.data.examScore = 0;
                this.data.examAnswers = {};
                this.generateExamQuestions();
                this.startExamTimer();
                this.updateExamUI();
            },

            // ç”Ÿæˆè€ƒè¯•é¢˜ç›®
            generateExamQuestions() {
                const library = this.getCurrentLibrary();
                if (library.questions.length === 0) {
                    this.data.examQuestions = [];
                    return;
                }

                // æŒ‰ç±»å‹åˆ†ç±»é¢˜ç›®
                const singleChoiceQuestions = library.questions.filter(q => q.ç±»å‹ === 'å•é€‰');
                const multiChoiceQuestions = library.questions.filter(q => q.ç±»å‹ === 'å¤šé€‰');
                const judgeQuestions = library.questions.filter(q => q.ç±»å‹ === 'åˆ¤æ–­');

                // éšæœºé€‰æ‹©é¢˜ç›®
                const selectedSingle = this.shuffleArray([...singleChoiceQuestions]).slice(0, 100);
                const selectedMulti = this.shuffleArray([...multiChoiceQuestions]).slice(0, 20);
                const selectedJudge = this.shuffleArray([...judgeQuestions]).slice(0, 30);

                // åˆå¹¶é¢˜ç›®
                this.data.examQuestions = [...selectedSingle, ...selectedMulti, ...selectedJudge];
                this.data.currentIndex = 0;

                // æ›´æ–°ä¾§è¾¹æ 
                this.updateExamSidebar();
            },

            // æ›´æ–°è€ƒè¯•ä¾§è¾¹æ 
            updateExamSidebar() {
                // å•é€‰é¢˜ç½‘æ ¼
                const singleGrid = document.getElementById('single-choice-grid');
                singleGrid.innerHTML = '';
                for (let i = 1; i <= 100; i++) {
                    const numberBtn = document.createElement('div');
                    numberBtn.className = 'question-number';
                    numberBtn.textContent = i;
                    numberBtn.addEventListener('click', () => {
                        this.data.currentIndex = i - 1;
                        this.updateExamUI();
                    });
                    singleGrid.appendChild(numberBtn);
                }

                // å¤šé€‰é¢˜ç½‘æ ¼
                const multiGrid = document.getElementById('multi-choice-grid');
                multiGrid.innerHTML = '';
                for (let i = 101; i <= 120; i++) {
                    const numberBtn = document.createElement('div');
                    numberBtn.className = 'question-number';
                    numberBtn.textContent = i;
                    numberBtn.addEventListener('click', () => {
                        this.data.currentIndex = i - 1;
                        this.updateExamUI();
                    });
                    multiGrid.appendChild(numberBtn);
                }

                // åˆ¤æ–­é¢˜ç½‘æ ¼
                const judgeGrid = document.getElementById('judge-grid');
                judgeGrid.innerHTML = '';
                for (let i = 121; i <= 150; i++) {
                    const numberBtn = document.createElement('div');
                    numberBtn.className = 'question-number';
                    numberBtn.textContent = i;
                    numberBtn.addEventListener('click', () => {
                        this.data.currentIndex = i - 1;
                        this.updateExamUI();
                    });
                    judgeGrid.appendChild(numberBtn);
                }

                this.updateQuestionNumberStyles();
            },

            // æ›´æ–°é¢˜ç›®æ•°å­—æ ·å¼
            updateQuestionNumberStyles() {
                const allNumbers = document.querySelectorAll('#exam-sidebar .question-number');
                allNumbers.forEach((number, index) => {
                    number.classList.remove('current', 'answered', 'wrong');

                    // å½“å‰é¢˜ç›®
                    if (index === this.data.currentIndex) {
                        number.classList.add('current');
                    }

                    // å·²ç­”é¢˜ç›®æ ‡è®° - è€ƒè¯•æ¨¡å¼ä¸‹å…¨éƒ¨æ˜¾ç¤ºç»¿è‰²åº•çº¹
                    if (this.data.examAnswers[index]) {
                        number.classList.add('answered');
                    }
                });
            },



            // è®¾ç½®ä¸»é¢˜åŠŸèƒ½ (æ·±å¤œæ¨¡å¼)
            setupTheme() {
                const themeToggle = document.getElementById('themeToggle');

                // åˆå§‹åŒ–ä¸»é¢˜
                if (this.data.isDarkMode) {
                    document.body.classList.add('dark-mode');
                    themeToggle.textContent = 'â˜€ï¸ æ—¥é—´æ¨¡å¼';
                    themeToggle.style.backgroundColor = '#f5f5f5';
                    themeToggle.style.color = '#333';
                }

                // ç›‘å¬åˆ‡æ¢
                themeToggle.addEventListener('click', () => {
                    this.data.isDarkMode = !this.data.isDarkMode;
                    document.body.classList.toggle('dark-mode');

                    if (this.data.isDarkMode) {
                        themeToggle.textContent = 'â˜€ï¸ æ—¥é—´æ¨¡å¼';
                        themeToggle.style.backgroundColor = '#f5f5f5';
                        themeToggle.style.color = '#333';
                    } else {
                        themeToggle.textContent = 'ğŸŒ™ æ·±å¤œæ¨¡å¼';
                        themeToggle.style.backgroundColor = '#333';
                        themeToggle.style.color = 'white';
                    }

                    this.saveToStorage();
                });
            },

            // æ‰“ä¹±æ•°ç»„
            shuffleArray(array) {
                const newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            },

            // é€€å‡ºè€ƒè¯•æ¨¡å¼
            exitExamMode() {
                this.data.examMode = false;
                this.data.examScore = 0;
                this.data.examAnswers = {};
                this.data.examQuestions = [];
                this.data.examStarted = false;
                this.stopExamTimer();
                // é‡ç½®è€ƒè¯•æ—¶é—´
                this.data.examTimeLeft = 90 * 60;
                this.updateExamTimerDisplay();
            },

            // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
            setupEventListeners() {
                // å­—ä½“å¤§å°æ§åˆ¶
                document.getElementById('decrease-font').addEventListener('click', () => {
                    this.data.questionFontSize = Math.max(8, this.data.questionFontSize - 1);
                    this.data.optionFontSize = Math.max(8, this.data.optionFontSize - 1);
                    this.updateFontSizes();
                });

                document.getElementById('increase-font').addEventListener('click', () => {
                    this.data.questionFontSize = Math.min(18, this.data.questionFontSize + 1);
                    this.data.optionFontSize = Math.min(18, this.data.optionFontSize + 1);
                    this.updateFontSizes();
                });

                // å¯¼å…¥é¢˜åº“
                document.getElementById('importButton').addEventListener('click', () => {
                    document.getElementById('fileInput').click();
                });

                document.getElementById('fileInput').addEventListener('change', (e) => {
                    this.importLibrary(e.target.files[0]);
                    e.target.value = '';
                });

                // åˆ é™¤å½“å‰é¢˜åº“
                document.getElementById('deleteLibraryButton').addEventListener('click', () => {
                    if (this.data.libraries.length === 0) {
                        alert('æ²¡æœ‰å¯åˆ é™¤çš„é¢˜åº“');
                        return;
                    }

                    if (confirm(`ç¡®å®šè¦åˆ é™¤é¢˜åº“ "${this.getCurrentLibrary().name}" å—ï¼Ÿ`)) {
                        this.data.libraries.splice(this.data.currentLibraryIndex, 1);

                        if (this.data.currentLibraryIndex >= this.data.libraries.length) {
                            this.data.currentLibraryIndex = Math.max(0, this.data.libraries.length - 1);
                        }

                        if (this.data.libraries.length === 0) {
                            this.data.currentIndex = 0;
                            this.data.mode = 'practice';
                            this.data.isShuffled = false;
                        }

                        this.saveToStorage();
                        this.updateUI();
                    }
                });

                // åˆ‡æ¢æ¨¡å¼
                document.getElementById('modeButton').addEventListener('click', () => {
                    this.data.mode = this.data.mode === 'practice' ? 'back' : 'practice';
                    this.saveToStorage();
                    this.updateUI();
                });

                // ç»ƒä¹ é”™é¢˜åº“åˆ‡æ¢æ¨¡å¼
                document.getElementById('practice-wrong-modeButton').addEventListener('click', () => {
                    this.data.practiceWrongMode = this.data.practiceWrongMode === 'practice' ? 'back' : 'practice';
                    this.updatePracticeWrongUI();
                });

                // è€ƒè¯•é”™é¢˜åº“åˆ‡æ¢æ¨¡å¼
                document.getElementById('exam-wrong-modeButton').addEventListener('click', () => {
                    this.data.examWrongMode = this.data.examWrongMode === 'practice' ? 'back' : 'practice';
                    this.updateExamWrongUI();
                });

                // å¯¼èˆªæŒ‰é’®
                document.getElementById('prevButton').addEventListener('click', () => {
                    this.prevQuestion();
                });

                document.getElementById('nextButton').addEventListener('click', () => {
                    this.nextQuestion();
                });

                // ç»ƒä¹ é”™é¢˜åº“å¯¼èˆªæŒ‰é’®
                document.getElementById('practice-wrong-prevButton').addEventListener('click', () => {
                    this.prevPracticeWrongQuestion();
                });

                document.getElementById('practice-wrong-nextButton').addEventListener('click', () => {
                    this.nextPracticeWrongQuestion();
                });

                // è€ƒè¯•é”™é¢˜åº“å¯¼èˆªæŒ‰é’®
                document.getElementById('exam-wrong-prevButton').addEventListener('click', () => {
                    this.prevExamWrongQuestion();
                });

                document.getElementById('exam-wrong-nextButton').addEventListener('click', () => {
                    this.nextExamWrongQuestion();
                });

                // é‡ç½®é¢˜åº“
                document.getElementById('resetLibraryButton').addEventListener('click', () => {
                    this.resetLibrary();
                });

                // è€ƒè¯•æ¨¡å¼å¯¼èˆªæŒ‰é’®
                document.getElementById('exam-prevButton').addEventListener('click', () => {
                    this.prevQuestion();
                });

                document.getElementById('exam-nextButton').addEventListener('click', () => {
                    this.nextQuestion();
                });

                // æäº¤è€ƒè¯•
                document.getElementById('submit-exam').addEventListener('click', () => {
                    this.submitExam();
                });

                // å¼€å§‹è€ƒè¯•
                document.getElementById('start-exam').addEventListener('click', () => {
                    this.startExam();
                });
            },

            // å¼€å§‹è€ƒè¯•
            startExam() {
                if (confirm('ç¡®å®šè¦å¼€å§‹è€ƒè¯•å—ï¼Ÿè€ƒè¯•æ—¶é—´ä¸º90åˆ†é’Ÿã€‚')) {
                    this.data.examStarted = true;
                    document.getElementById('exam-start-container').classList.add('hidden');
                    document.getElementById('exam-layout').classList.remove('hidden');
                    this.enterExamMode();
                }
            },

            // æ›´æ–°å­—ä½“å¤§å°
            updateFontSizes() {
                // æ›´æ–°CSSå˜é‡
                document.documentElement.style.setProperty('--question-font-size', `${this.data.questionFontSize}px`);
                document.documentElement.style.setProperty('--option-font-size', `${this.data.optionFontSize}px`);

                // æ›´æ–°æ˜¾ç¤º
                document.getElementById('font-size-display').textContent = `${this.data.questionFontSize}px`;

                this.saveToStorage();
            },

            // è·å–å½“å‰é¢˜åº“
            getCurrentLibrary() {
                return this.data.libraries[this.data.currentLibraryIndex] || {
                    name: 'æœªå‘½åé¢˜åº“',
                    questions: [],
                    userAnswers: {},
                    originalOrder: []
                };
            },

            // è·å–å½“å‰é¢˜ç›®
            getCurrentQuestion() {
                if (this.data.examMode) {
                    return this.data.examQuestions[this.data.currentIndex] || {};
                } else {
                    const library = this.getCurrentLibrary();
                    return library.questions[this.data.currentIndex] || {};
                }
            },

            // è·å–å½“å‰ç»ƒä¹ é”™é¢˜
            getCurrentPracticeWrongQuestion() {
                return this.data.practiceWrongQuestions[this.data.practiceWrongCurrentIndex] || {};
            },

            // è·å–å½“å‰è€ƒè¯•é”™é¢˜
            getCurrentExamWrongQuestion() {
                return this.data.examWrongQuestions[this.data.examWrongCurrentIndex] || {};
            },

            // å¯¼å…¥é¢˜åº“
            importLibrary(file) {
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const sheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[sheetName];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

                        // åˆ›å»ºæ–°é¢˜åº“
                        const newLibrary = {
                            name: file.name.replace(/\.[^/.]+$/, ""),
                            questions: jsonData.map(row => ({
                                é¢˜å¹²: row[0] || '',
                                ç­”æ¡ˆ: (row[1] || '').toString().trim().toUpperCase().replace(/[^A-Zå¯¹é”™]/g, ''),
                                ç±»å‹: this.determineQuestionType(row[1]),
                                é€‰é¡¹A: row[2] || '',
                                é€‰é¡¹B: row[3] || '',
                                é€‰é¡¹C: row[4] || '',
                                é€‰é¡¹D: row[5] || '',
                                é€‰é¡¹E: row[6] || '',
                                é€‰é¡¹F: row[7] || '',
                                é€‰é¡¹G: row[8] || '',
                                é€‰é¡¹H: row[9] || '',
                                è§£æ: row[10] || '',
                                éš¾åº¦: row[11] || 'ä¸­ç­‰',
                                åˆ†ç±»: row[12] || 'æœªåˆ†ç±»',
                                åˆ†å€¼: this.getQuestionScore(this.determineQuestionType(row[1]))
                            })).filter(q => q.é¢˜å¹²),
                            userAnswers: {},
                            originalOrder: []
                        };

                        // æ·»åŠ åˆ°é¢˜åº“åˆ—è¡¨
                        this.data.libraries.push(newLibrary);
                        this.data.currentLibraryIndex = this.data.libraries.length - 1;
                        this.data.currentIndex = 0;

                        this.saveToStorage();
                        this.updateUI();
                    } catch (error) {
                        alert('å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®');
                        console.error(error);
                    }
                };
                reader.readAsArrayBuffer(file);
            },

            // ç¡®å®šé¢˜ç›®ç±»å‹
            determineQuestionType(answer) {
                if (!answer) return 'æœªçŸ¥';

                const answerStr = answer.toString().trim().toUpperCase();

                // åˆ¤æ–­é¢˜
                if (answerStr === 'å¯¹' || answerStr === 'é”™' ||
                    answerStr === 'æ­£ç¡®' || answerStr === 'é”™è¯¯' ||
                    answerStr === 'TRUE' || answerStr === 'FALSE') {
                    return 'åˆ¤æ–­';
                }

                // å¤šé€‰é¢˜
                if (answerStr.replace(/[^A-Z]/g, '').length > 1) {
                    return 'å¤šé€‰';
                }

                // å•é€‰é¢˜
                return 'å•é€‰';
            },

            // è·å–é¢˜ç›®åˆ†å€¼
            getQuestionScore(type) {
                switch (type) {
                    case 'å•é€‰': return 0.5;
                    case 'å¤šé€‰': return 1;
                    case 'åˆ¤æ–­': return 1;
                    default: return 1;
                }
            },

            // åˆ‡æ¢é¢˜åº“
            switchLibrary(index) {
                if (index >= 0 && index < this.data.libraries.length) {
                    this.data.currentLibraryIndex = index;
                    this.data.currentIndex = 0;
                    this.saveToStorage();
                    this.updateUI();
                }
            },

            // ä¸Šä¸€é¢˜
            prevQuestion() {
                if (this.data.currentIndex > 0) {
                    this.data.currentIndex--;
                    this.saveToStorage();
                    this.updateUI();
                } else {
                    alert('å·²ç»æ˜¯ç¬¬ä¸€é¢˜äº†');
                }
            },

            // ä¸‹ä¸€é¢˜
            nextQuestion() {
                const maxIndex = this.data.examMode ?
                    this.data.examQuestions.length - 1 :
                    this.getCurrentLibrary().questions.length - 1;

                if (this.data.currentIndex < maxIndex) {
                    this.data.currentIndex++;
                    this.saveToStorage();
                    this.updateUI();
                } else {
                    alert('å·²ç»æ˜¯æœ€åä¸€é¢˜äº†');
                    if (this.data.examMode) {
                        alert('å·²åˆ°è¾¾æœ€åä¸€é¢˜ï¼Œè¯·æäº¤è€ƒè¯•');
                    }
                }
            },

            // ç»ƒä¹ é”™é¢˜åº“ä¸Šä¸€é¢˜
            prevPracticeWrongQuestion() {
                if (this.data.practiceWrongCurrentIndex > 0) {
                    this.data.practiceWrongCurrentIndex--;
                    // ç¦»å¼€é¢˜ç›®æ—¶æ¸…é™¤å½“å‰é¢˜ç›®çš„ä¸´æ—¶é€‰æ‹©çŠ¶æ€
                    delete this.data.practiceWrongMultiSelectAnswers[this.data.practiceWrongCurrentIndex + 1];
                    this.updatePracticeWrongUI();
                } else {
                    alert('å·²ç»æ˜¯ç¬¬ä¸€é¢˜äº†');
                }
            },

            // ç»ƒä¹ é”™é¢˜åº“ä¸‹ä¸€é¢˜
            nextPracticeWrongQuestion() {
                const maxIndex = this.data.practiceWrongQuestions.length - 1;

                if (this.data.practiceWrongCurrentIndex < maxIndex) {
                    this.data.practiceWrongCurrentIndex++;
                    // ç¦»å¼€é¢˜ç›®æ—¶æ¸…é™¤å½“å‰é¢˜ç›®çš„ä¸´æ—¶é€‰æ‹©çŠ¶æ€
                    delete this.data.practiceWrongMultiSelectAnswers[this.data.practiceWrongCurrentIndex - 1];
                    this.updatePracticeWrongUI();
                } else {
                    alert('å·²ç»æ˜¯æœ€åä¸€é¢˜äº†');
                }
            },

            // è€ƒè¯•é”™é¢˜åº“ä¸Šä¸€é¢˜
            prevExamWrongQuestion() {
                if (this.data.examWrongCurrentIndex > 0) {
                    this.data.examWrongCurrentIndex--;
                    // ç¦»å¼€é¢˜ç›®æ—¶æ¸…é™¤å½“å‰é¢˜ç›®çš„ä¸´æ—¶é€‰æ‹©çŠ¶æ€
                    delete this.data.examWrongMultiSelectAnswers[this.data.examWrongCurrentIndex + 1];
                    this.updateExamWrongUI();
                } else {
                    alert('å·²ç»æ˜¯ç¬¬ä¸€é¢˜äº†');
                }
            },

            // è€ƒè¯•é”™é¢˜åº“ä¸‹ä¸€é¢˜
            nextExamWrongQuestion() {
                const maxIndex = this.data.examWrongQuestions.length - 1;

                if (this.data.examWrongCurrentIndex < maxIndex) {
                    this.data.examWrongCurrentIndex++;
                    // ç¦»å¼€é¢˜ç›®æ—¶æ¸…é™¤å½“å‰é¢˜ç›®çš„ä¸´æ—¶é€‰æ‹©çŠ¶æ€
                    delete this.data.examWrongMultiSelectAnswers[this.data.examWrongCurrentIndex - 1];
                    this.updateExamWrongUI();
                } else {
                    alert('å·²ç»æ˜¯æœ€åä¸€é¢˜äº†');
                }
            },

            // é€‰æ‹©é€‰é¡¹ï¼ˆè€ƒè¯•æ¨¡å¼ï¼‰
            selectExamOption(optionLetter) {
                if (!this.data.examMode) return;

                const currentQuestion = this.getCurrentQuestion();

                // å¤„ç†åˆ¤æ–­é¢˜
                let processedOption = optionLetter;
                if (currentQuestion.ç±»å‹ === 'åˆ¤æ–­') {
                    if (optionLetter === 'A') processedOption = 'å¯¹';
                    else if (optionLetter === 'B') processedOption = 'é”™';
                }

                // å•é€‰é¢˜å’Œåˆ¤æ–­é¢˜
                if (currentQuestion.ç±»å‹ === 'å•é€‰' || currentQuestion.ç±»å‹ === 'åˆ¤æ–­') {
                    this.data.examAnswers[this.data.currentIndex] = {
                        selected: processedOption,
                        isCorrect: processedOption === currentQuestion.ç­”æ¡ˆ
                    };
                }
                // å¤šé€‰é¢˜
                else if (currentQuestion.ç±»å‹ === 'å¤šé€‰') {
                    let currentAnswer = this.data.examAnswers[this.data.currentIndex] || {
                        selected: [],
                        isCorrect: false
                    };

                    const index = currentAnswer.selected.indexOf(optionLetter);
                    if (index === -1) {
                        currentAnswer.selected.push(optionLetter);
                    } else {
                        currentAnswer.selected.splice(index, 1);
                    }

                    this.data.examAnswers[this.data.currentIndex] = currentAnswer;
                }

                this.updateOptionStyles();
                this.updateQuestionNumberStyles();
            },

            // é€‰æ‹©é€‰é¡¹ï¼ˆç»ƒä¹ æ¨¡å¼ï¼‰
            selectOption(optionLetter) {
                if (this.data.mode !== 'practice') return;

                const currentQuestion = this.getCurrentQuestion();
                const library = this.getCurrentLibrary();

                // å¤„ç†åˆ¤æ–­é¢˜
                let processedOption = optionLetter;
                if (currentQuestion.ç±»å‹ === 'åˆ¤æ–­') {
                    if (optionLetter === 'A') processedOption = 'å¯¹';
                    else if (optionLetter === 'B') processedOption = 'é”™';
                }

                // ä¸ºå•é€‰å’Œåˆ¤æ–­ç«‹å³æ ‡è®°æäº¤çŠ¶æ€
                if (currentQuestion.ç±»å‹ === 'å•é€‰' || currentQuestion.ç±»å‹ === 'åˆ¤æ–­') {
                    library.userAnswers[this.data.currentIndex] = {
                        selected: processedOption,
                        isCorrect: processedOption === currentQuestion.ç­”æ¡ˆ,
                        isSubmitted: true
                    };

                    this.saveToStorage();
                    this.updateOptionStyles();
                    this.renderAnswerAndExplanation();
                    this.updatePracticeQuestionNumberStyles();

                    // æ˜¾ç¤ºç­”é¢˜ç»“æœ
                    const resultDiv = document.getElementById('answer-result');
                    if (processedOption === currentQuestion.ç­”æ¡ˆ) {
                        resultDiv.textContent = 'å›ç­”æ­£ç¡®';
                        resultDiv.style.color = 'var(--correct-color)';
                    } else {
                        resultDiv.textContent = `å›ç­”é”™è¯¯ï¼Œä½ çš„ç­”æ¡ˆæ˜¯ ${processedOption}`;
                        resultDiv.style.color = 'var(--wrong-color)';
                    }

                    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                    this.updateStatsDisplay();
                }
            },

            toggleMultiSelectOption(letter) {
                const currentLibrary = this.getCurrentLibrary();
                let userAnswer = currentLibrary.userAnswers[this.data.currentIndex] || {
                    selected: [],
                    isSubmitted: false
                };

                if (!userAnswer.isSubmitted) {
                    const index = userAnswer.selected.indexOf(letter);
                    if (index === -1) {
                        userAnswer.selected.push(letter);
                    } else {
                        userAnswer.selected.splice(index, 1);
                    }

                    currentLibrary.userAnswers[this.data.currentIndex] = userAnswer;
                    this.saveToStorage();
                    this.updateOptionStyles();
                }
            },

            // æ›´æ–°é€‰é¡¹æ ·å¼
            updateOptionStyles() {
                const question = this.getCurrentQuestion();
                const library = this.getCurrentLibrary();
                const userAnswer = library.userAnswers[this.data.currentIndex];
                const examAnswer = this.data.examAnswers[this.data.currentIndex];
                const options = this.data.examMode ?
                    document.querySelectorAll('#exam-options .option') :
                    document.querySelectorAll('#options .option');

                options.forEach(option => {
                    option.classList.remove('correct-answer', 'wrong-answer', 'selected', 'exam-selected');
                    const letter = option.querySelector('.option-letter').textContent.trim();

                    // èƒŒé¢˜æ¨¡å¼ï¼ˆä¿æŒåŸæœ‰é€»è¾‘ï¼‰
                    if (this.data.mode === 'back') {
                        if (question.ç­”æ¡ˆ.includes(letter)) {
                            option.classList.add('correct-answer');
                        }
                        return;
                    }

                    // è€ƒè¯•æ¨¡å¼ - åªæ˜¾ç¤ºé€‰ä¸­çŠ¶æ€
                    if (this.data.examMode) {
                        if (examAnswer) {
                            // å•é€‰é¢˜å’Œåˆ¤æ–­é¢˜
                            if (question.ç±»å‹ === 'å•é€‰' || question.ç±»å‹ === 'åˆ¤æ–­') {
                                let userSelected = examAnswer.selected;
                                // å¯¹äºåˆ¤æ–­é¢˜ï¼Œéœ€è¦è½¬æ¢é€‰é¡¹
                                if (question.ç±»å‹ === 'åˆ¤æ–­') {
                                    if (userSelected === 'å¯¹') userSelected = 'A';
                                    else if (userSelected === 'é”™') userSelected = 'B';
                                }

                                if (userSelected === letter) {
                                    option.classList.add('exam-selected');
                                }
                            }
                            // å¤šé€‰é¢˜
                            else if (question.ç±»å‹ === 'å¤šé€‰') {
                                if (examAnswer.selected && examAnswer.selected.includes(letter)) {
                                    option.classList.add('exam-selected');
                                }
                            }
                        }
                        return;
                    }

                    // ç»ƒä¹ æ¨¡å¼ï¼ˆä¿®æ”¹åçš„å•é€‰é€»è¾‘ï¼‰
                    if (question.ç±»å‹ === 'å•é€‰' || question.ç±»å‹ === 'åˆ¤æ–­') {
                        // åªæœ‰ç”¨æˆ·å·²ä½œç­”æ—¶æ˜¾ç¤ºæ­£ç¡®/é”™è¯¯
                        if (userAnswer) {
                            // ç”¨æˆ·é€‰æ‹©çš„é€‰é¡¹
                            let userSelected = userAnswer.selected;
                            // å¯¹äºåˆ¤æ–­é¢˜ï¼Œéœ€è¦è½¬æ¢é€‰é¡¹
                            if (question.ç±»å‹ === 'åˆ¤æ–­') {
                                if (userSelected === 'å¯¹') userSelected = 'A';
                                else if (userSelected === 'é”™') userSelected = 'B';
                            }

                            if (userSelected === letter) {
                                option.classList.add(userAnswer.isCorrect ? 'correct-answer' : 'wrong-answer');
                            }
                            // æ­£ç¡®ç­”æ¡ˆï¼ˆä»…åœ¨ç”¨æˆ·ä½œç­”åæ˜¾ç¤ºï¼‰
                            let correctAnswer = question.ç­”æ¡ˆ;
                            if (question.ç±»å‹ === 'åˆ¤æ–­') {
                                if (correctAnswer === 'å¯¹') correctAnswer = 'A';
                                else if (correctAnswer === 'é”™') correctAnswer = 'B';
                            }

                            if (correctAnswer === letter) {
                                option.classList.add('correct-answer');
                            }
                        }
                    }
                    // å¤šé€‰é€»è¾‘ä¿æŒä¸å˜
                    else if (question.ç±»å‹ === 'å¤šé€‰') {
                        if (userAnswer?.isSubmitted) {
                            if (question.ç­”æ¡ˆ.includes(letter)) {
                                option.classList.add('correct-answer');
                            }
                            if (userAnswer.selected.includes(letter) && !question.ç­”æ¡ˆ.includes(letter)) {
                                option.classList.add('wrong-answer');
                            }
                        } else {
                            if (userAnswer?.selected?.includes(letter)) {
                                option.classList.add('selected');
                            }
                        }
                    }
                });
            },

            handleMultiSelectSubmit() {
                const currentLibrary = this.getCurrentLibrary();
                const question = this.getCurrentQuestion();
                let userAnswer = currentLibrary.userAnswers[this.data.currentIndex];

                if (!userAnswer || userAnswer.selected.length === 0) return;

                const correctLetters = [...question.ç­”æ¡ˆ].sort().join('');
                const userLetters = [...userAnswer.selected].sort().join('');
                userAnswer.isCorrect = correctLetters === userLetters;
                userAnswer.isSubmitted = true;

                this.saveToStorage();
                this.updateOptionStyles();
                this.renderAnswerAndExplanation();
                this.updatePracticeQuestionNumberStyles();

                // æ˜¾ç¤ºç­”é¢˜ç»“æœ
                const resultDiv = document.getElementById('answer-result');
                if (correctLetters === userLetters) {
                    resultDiv.textContent = 'å›ç­”æ­£ç¡®';
                    resultDiv.style.color = 'var(--correct-color)';
                } else {
                    resultDiv.textContent = `å›ç­”é”™è¯¯ï¼Œä½ çš„ç­”æ¡ˆæ˜¯ ${userLetters}`;
                    resultDiv.style.color = 'var(--wrong-color)';
                }

                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                this.updateStatsDisplay();
            },

            // æ¸²æŸ“é¢˜ç›®
            renderQuestion() {
                const question = this.getCurrentQuestion();
                const optionsContainer = this.data.examMode ?
                    document.getElementById('exam-options') :
                    document.getElementById('options');
                optionsContainer.innerHTML = '';

                const questionElement = this.data.examMode ?
                    document.getElementById('exam-question') :
                    document.getElementById('question');

                // æ·»åŠ éš¾åº¦æ ‡ç­¾
                let difficultyTag = '';
                if (question.éš¾åº¦) {
                    let difficultyClass = '';
                    if (question.éš¾åº¦ === 'ç®€å•') difficultyClass = 'difficulty-easy';
                    else if (question.éš¾åº¦ === 'ä¸­ç­‰') difficultyClass = 'difficulty-medium';
                    else if (question.éš¾åº¦ === 'å›°éš¾') difficultyClass = 'difficulty-hard';

                    difficultyTag = `<span class="difficulty-tag ${difficultyClass}">${question.éš¾åº¦}</span>`;
                }

                questionElement.innerHTML = `
                    ${question.é¢˜å¹² || 'æš‚æ— é¢˜ç›®'}
                    <span class="question-type">${question.ç±»å‹ || 'æœªçŸ¥'}</span>
                    ${difficultyTag}
                    ${question.åˆ†å€¼ ? `<span class="question-type">${question.åˆ†å€¼}åˆ†</span>` : ''}
                `;

                // æ›´æ–°é€‰é¡¹å­—æ¯ï¼Œæ”¯æŒA-H
                const optionLetters = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'];
                const currentLibrary = this.getCurrentLibrary();
                const userAnswer = currentLibrary.userAnswers[this.data.currentIndex];
                const isMultiSelect = question.ç±»å‹ === 'å¤šé€‰';
                const isJudgement = question.ç±»å‹ === 'åˆ¤æ–­';

                // åˆ¤æ–­é¢˜ç‰¹æ®Šå¤„ç†
                if (isJudgement) {
                    const optionTrue = document.createElement('button');
                    optionTrue.className = 'option';
                    optionTrue.innerHTML = `
                        <span class="option-letter">A</span>
                        <span class="option-text">å¯¹</span>
                    `;

                    const optionFalse = document.createElement('button');
                    optionFalse.className = 'option';
                    optionFalse.innerHTML = `
                        <span class="option-letter">B</span>
                        <span class="option-text">é”™</span>
                    `;

                    if (this.data.mode === 'back') {
                        optionTrue.classList.add('back-mode-option');
                        optionFalse.classList.add('back-mode-option');
                        if (question.ç­”æ¡ˆ === 'å¯¹') {
                            optionTrue.classList.add('correct-answer');
                        } else if (question.ç­”æ¡ˆ === 'é”™') {
                            optionFalse.classList.add('correct-answer');
                        }
                    } else {
                        if (this.data.examMode) {
                            optionTrue.addEventListener('click', () => this.selectExamOption('A'));
                            optionFalse.addEventListener('click', () => this.selectExamOption('B'));
                        } else {
                            optionTrue.addEventListener('click', () => this.selectOption('A'));
                            optionFalse.addEventListener('click', () => this.selectOption('B'));
                        }
                    }

                    optionsContainer.appendChild(optionTrue);
                    optionsContainer.appendChild(optionFalse);
                } else {
                    // å¸¸è§„é¢˜ç›®
                    optionLetters.forEach((letter) => {
                        const optionKey = `é€‰é¡¹${letter}`;
                        if (question[optionKey]) {
                            const option = document.createElement('button');
                            option.className = 'option';
                            option.innerHTML = `
                                <span class="option-letter">${letter}</span>
                                <span class="option-text">${question[optionKey]}</span>
                            `;

                            if (this.data.mode === 'back') {
                                option.classList.add('back-mode-option');
                                if (question.ç­”æ¡ˆ.includes(letter)) {
                                    option.classList.add('correct-answer');
                                }
                            } else {
                                if (this.data.examMode) {
                                    // è€ƒè¯•æ¨¡å¼
                                    if (isMultiSelect) {
                                        option.addEventListener('click', () => this.selectExamOption(letter));
                                    } else {
                                        option.addEventListener('click', () => this.selectExamOption(letter));
                                    }
                                } else {
                                    // ç»ƒä¹ æ¨¡å¼
                                    if (isMultiSelect) {
                                        option.addEventListener('click', () => this.toggleMultiSelectOption(letter));
                                    } else {
                                        option.addEventListener('click', () => this.selectOption(letter));
                                    }
                                }
                            }

                            optionsContainer.appendChild(option);
                        }
                    });
                }

                // ç»ƒä¹ æ¨¡å¼ä¸‹çš„å¤šé€‰é¢˜æäº¤æŒ‰é’®
                if (isMultiSelect && this.data.mode === 'practice' && !this.data.examMode) {
                    const submitButton = document.createElement('button');
                    submitButton.id = 'submitButton';
                    submitButton.className = 'button button-success';
                    submitButton.textContent = 'æäº¤ç­”æ¡ˆ';
                    submitButton.addEventListener('click', () => this.handleMultiSelectSubmit());
                    optionsContainer.appendChild(submitButton);
                }

                this.updateOptionStyles();

                // æ¸…é™¤ç­”é¢˜ç»“æœ
                if (this.data.examMode) {
                    document.getElementById('exam-answer-result').textContent = '';
                } else {
                    document.getElementById('answer-result').textContent = '';
                }
            },

            // æ¸²æŸ“ç»ƒä¹ é”™é¢˜åº“é¢˜ç›®
            renderPracticeWrongQuestion() {
                const question = this.getCurrentPracticeWrongQuestion();
                const optionsContainer = document.getElementById('practice-wrong-options');
                optionsContainer.innerHTML = '';

                const questionElement = document.getElementById('practice-wrong-question');

                // æ·»åŠ éš¾åº¦æ ‡ç­¾
                let difficultyTag = '';
                if (question.éš¾åº¦) {
                    let difficultyClass = '';
                    if (question.éš¾åº¦ === 'ç®€å•') difficultyClass = 'difficulty-easy';
                    else if (question.éš¾åº¦ === 'ä¸­ç­‰') difficultyClass = 'difficulty-medium';
                    else if (question.éš¾åº¦ === 'å›°éš¾') difficultyClass = 'difficulty-hard';

                    difficultyTag = `<span class="difficulty-tag ${difficultyClass}">${question.éš¾åº¦}</span>`;
                }

                questionElement.innerHTML = `
                    ${question.é¢˜å¹² || 'æš‚æ— é¢˜ç›®'}
                    <span class="question-type">${question.ç±»å‹ || 'æœªçŸ¥'}</span>
                    ${difficultyTag}
                    ${question.åˆ†å€¼ ? `<span class="question-type">${question.åˆ†å€¼}åˆ†</span>` : ''}
                `;

                // æ›´æ–°é€‰é¡¹å­—æ¯ï¼Œæ”¯æŒA-H
                const optionLetters = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'];
                const isJudgement = question.ç±»å‹ === 'åˆ¤æ–­';

                // æ›´æ–°æ¨¡å¼æŒ‰é’®æ–‡æœ¬
                document.getElementById('practice-wrong-modeButton').textContent =
                    this.data.practiceWrongMode === 'practice' ? 'åˆ‡æ¢åˆ°èƒŒé¢˜æ¨¡å¼' : 'åˆ‡æ¢åˆ°ç»ƒä¹ æ¨¡å¼';

                // åˆ¤æ–­é¢˜ç‰¹æ®Šå¤„ç†
                if (isJudgement) {
                    const optionTrue = document.createElement('button');
                    optionTrue.className = 'option';
                    optionTrue.innerHTML = `
                        <span class="option-letter">A</span>
                        <span class="option-text">å¯¹</span>
                    `;

                    const optionFalse = document.createElement('button');
                    optionFalse.className = 'option';
                    optionFalse.innerHTML = `
                        <span class="option-letter">B</span>
                        <span class="option-text">é”™</span>
                    `;

                    if (this.data.practiceWrongMode === 'back') {
                        optionTrue.classList.add('back-mode-option');
                        optionFalse.classList.add('back-mode-option');
                        if (question.ç­”æ¡ˆ === 'å¯¹') {
                            optionTrue.classList.add('correct-answer');
                        } else if (question.ç­”æ¡ˆ === 'é”™') {
                            optionFalse.classList.add('correct-answer');
                        }
                    } else {
                        optionTrue.addEventListener('click', () => this.selectPracticeWrongOption('A'));
                        optionFalse.addEventListener('click', () => this.selectPracticeWrongOption('B'));
                    }

                    optionsContainer.appendChild(optionTrue);
                    optionsContainer.appendChild(optionFalse);
                } else {
                    // å¸¸è§„é¢˜ç›®
                    optionLetters.forEach((letter) => {
                        const optionKey = `é€‰é¡¹${letter}`;
                        if (question[optionKey]) {
                            const option = document.createElement('button');
                            option.className = 'option';
                            option.innerHTML = `
                                <span class="option-letter">${letter}</span>
                                <span class="option-text">${question[optionKey]}</span>
                            `;

                            if (this.data.practiceWrongMode === 'back') {
                                option.classList.add('back-mode-option');
                                if (question.ç±»å‹ === 'åˆ¤æ–­') {
                                    if ((question.ç­”æ¡ˆ === 'å¯¹' && letter === 'A') ||
                                        (question.ç­”æ¡ˆ === 'é”™' && letter === 'B')) {
                                        option.classList.add('correct-answer');
                                    }
                                } else {
                                    if (question.ç­”æ¡ˆ.includes(letter)) {
                                        option.classList.add('correct-answer');
                                    }
                                }
                            } else {
                                if (question.ç±»å‹ === 'å¤šé€‰') {
                                    option.addEventListener('click', () => this.togglePracticeWrongMultiSelectOption(letter));
                                } else {
                                    option.addEventListener('click', () => this.selectPracticeWrongOption(letter));
                                }
                            }

                            optionsContainer.appendChild(option);
                        }
                    });
                }

                // ç»ƒä¹ æ¨¡å¼ä¸‹çš„å¤šé€‰é¢˜æäº¤æŒ‰é’®
                if (question.ç±»å‹ === 'å¤šé€‰' && this.data.practiceWrongMode === 'practice') {
                    const submitButton = document.createElement('button');
                    submitButton.id = 'practice-wrong-submitButton';
                    submitButton.className = 'button button-success';
                    submitButton.textContent = 'æäº¤ç­”æ¡ˆ';
                    submitButton.addEventListener('click', () => this.handlePracticeWrongMultiSelectSubmit());
                    optionsContainer.appendChild(submitButton);
                }

                // æ˜¾ç¤ºç­”æ¡ˆå’Œè§£æ - ä¿®å¤ï¼šç­”é”™æ—¶æ˜¾ç¤ºç­”æ¡ˆå’Œè§£æ
                const library = this.getCurrentLibrary();
                const userAnswer = library.userAnswers[question.originalIndex];

                if (this.data.practiceWrongMode === 'back' || (userAnswer && userAnswer.isSubmitted && !userAnswer.isCorrect)) {
                    document.getElementById('practice-wrong-answer-container').classList.remove('hidden');
                    document.getElementById('practice-wrong-explanation-container').classList.remove('hidden');

                    document.getElementById('practice-wrong-correct-answer').textContent =
                        question.ç±»å‹ === 'å¤šé€‰' ? [...question.ç­”æ¡ˆ].join(', ') : question.ç­”æ¡ˆ;
                    document.getElementById('practice-wrong-explanation').textContent = question.è§£æ || 'æš‚æ— è§£æ';
                } else {
                    document.getElementById('practice-wrong-answer-container').classList.add('hidden');
                    document.getElementById('practice-wrong-explanation-container').classList.add('hidden');
                }

                // æ˜¾ç¤ºç”¨æˆ·ç­”æ¡ˆ
                const resultDiv = document.getElementById('practice-wrong-answer-result');
                if (this.data.practiceWrongMode === 'practice') {
                    if (userAnswer && userAnswer.isSubmitted) {
                        if (Array.isArray(userAnswer.selected)) {
                            resultDiv.textContent = `ä½ çš„ç­”æ¡ˆ: ${userAnswer.selected.join(', ')}`;
                        } else {
                            resultDiv.textContent = `ä½ çš„ç­”æ¡ˆ: ${userAnswer.selected}`;
                        }
                        resultDiv.style.color = userAnswer.isCorrect ? 'var(--correct-color)' : 'var(--wrong-color)';
                    } else {
                        resultDiv.textContent = '';
                    }
                } else {
                    resultDiv.textContent = '';
                }

                // æ›´æ–°ç»ƒä¹ é”™é¢˜åº“é€‰é¡¹æ ·å¼
                this.updatePracticeWrongOptionStyles();
            },

            // é€‰æ‹©ç»ƒä¹ é”™é¢˜åº“é€‰é¡¹
            selectPracticeWrongOption(optionLetter) {
                if (this.data.practiceWrongMode !== 'practice') return;

                const currentQuestion = this.getCurrentPracticeWrongQuestion();
                const library = this.getCurrentLibrary();

                // å¤„ç†åˆ¤æ–­é¢˜
                let processedOption = optionLetter;
                if (currentQuestion.ç±»å‹ === 'åˆ¤æ–­') {
                    if (optionLetter === 'A') processedOption = 'å¯¹';
                    else if (optionLetter === 'B') processedOption = 'é”™';
                }

                // ä¸ºå•é€‰å’Œåˆ¤æ–­ç«‹å³æ ‡è®°æäº¤çŠ¶æ€
                if (currentQuestion.ç±»å‹ === 'å•é€‰' || currentQuestion.ç±»å‹ === 'åˆ¤æ–­') {
                    const isCorrect = processedOption === currentQuestion.ç­”æ¡ˆ;

                    // è®°å½•ç­”é¢˜æ¬¡æ•°
                    this.recordQuestionPractice(currentQuestion.originalIndex, isCorrect);

                    // æ›´æ–°ç”¨æˆ·ç­”æ¡ˆ
                    library.userAnswers[currentQuestion.originalIndex] = {
                        selected: processedOption,
                        isCorrect: isCorrect,
                        isSubmitted: true
                    };

                    this.saveToStorage();
                    this.updatePracticeWrongOptionStyles();

                    // æ˜¾ç¤ºç­”é¢˜ç»“æœ
                    const resultDiv = document.getElementById('practice-wrong-answer-result');
                    if (isCorrect) {
                        resultDiv.textContent = 'å›ç­”æ­£ç¡®';
                        resultDiv.style.color = 'var(--correct-color)';
                    } else {
                        resultDiv.textContent = `å›ç­”é”™è¯¯ï¼Œä½ çš„ç­”æ¡ˆæ˜¯ ${processedOption}`;
                        resultDiv.style.color = 'var(--wrong-color)';
                        // ç­”é”™æ—¶æ˜¾ç¤ºç­”æ¡ˆå’Œè§£æ
                        document.getElementById('practice-wrong-answer-container').classList.remove('hidden');
                        document.getElementById('practice-wrong-explanation-container').classList.remove('hidden');
                    }

                    // å¦‚æœè¿ç»­ç­”å¯¹3æ¬¡ï¼Œä»é”™é¢˜åº“ä¸­ç§»é™¤
                    if (isCorrect) {
                        const correctCount = this.getCorrectCount(currentQuestion.originalIndex);
                        if (correctCount >= 3) {
                            setTimeout(() => {
                                this.removeFromPracticeWrongQuestions(currentQuestion.originalIndex);
                                // åˆ·æ–°ä¾§è¾¹æ 
                                this.updatePracticeWrongSidebar();
                            }, 1000);
                        } else {
                            // å³ä½¿æ²¡æœ‰ç§»é™¤ï¼Œä¹Ÿè¦åˆ·æ–°ä¾§è¾¹æ æ˜¾ç¤ºçŠ¶æ€
                            this.updatePracticeWrongSidebar();
                        }
                    } else {
                        // ç­”é”™æ—¶ä¹Ÿè¦åˆ·æ–°ä¾§è¾¹æ 
                        this.updatePracticeWrongSidebar();
                    }
                }
            },

            // ç»ƒä¹ é”™é¢˜åº“å¤šé€‰é¢˜é€‰é¡¹åˆ‡æ¢
            togglePracticeWrongMultiSelectOption(letter) {
                const currentQuestion = this.getCurrentPracticeWrongQuestion();
                if (!this.data.practiceWrongMultiSelectAnswers[this.data.practiceWrongCurrentIndex]) {
                    this.data.practiceWrongMultiSelectAnswers[this.data.practiceWrongCurrentIndex] = {
                        selected: [],
                        isSubmitted: false
                    };
                }

                let userAnswer = this.data.practiceWrongMultiSelectAnswers[this.data.practiceWrongCurrentIndex];

                if (!userAnswer.isSubmitted) {
                    const index = userAnswer.selected.indexOf(letter);
                    if (index === -1) {
                        userAnswer.selected.push(letter);
                    } else {
                        userAnswer.selected.splice(index, 1);
                    }

                    this.updatePracticeWrongOptionStyles();
                }
            },

            // å¤„ç†ç»ƒä¹ é”™é¢˜åº“å¤šé€‰é¢˜æäº¤
            handlePracticeWrongMultiSelectSubmit() {
                const currentQuestion = this.getCurrentPracticeWrongQuestion();
                const library = this.getCurrentLibrary();
                let userAnswer = this.data.practiceWrongMultiSelectAnswers[this.data.practiceWrongCurrentIndex];

                if (!userAnswer || userAnswer.selected.length === 0) return;

                const correctLetters = [...currentQuestion.ç­”æ¡ˆ].sort().join('');
                const userLetters = [...userAnswer.selected].sort().join('');
                const isCorrect = correctLetters === userLetters;

                // è®°å½•ç­”é¢˜æ¬¡æ•°
                this.recordQuestionPractice(currentQuestion.originalIndex, isCorrect);

                // æ›´æ–°ç”¨æˆ·ç­”æ¡ˆ
                library.userAnswers[currentQuestion.originalIndex] = {
                    selected: userAnswer.selected,
                    isCorrect: isCorrect,
                    isSubmitted: true
                };

                userAnswer.isCorrect = isCorrect;
                userAnswer.isSubmitted = true;

                this.saveToStorage();
                this.updatePracticeWrongOptionStyles();

                // æ˜¾ç¤ºç­”é¢˜ç»“æœ
                const resultDiv = document.getElementById('practice-wrong-answer-result');
                if (isCorrect) {
                    resultDiv.textContent = 'å›ç­”æ­£ç¡®';
                    resultDiv.style.color = 'var(--correct-color)';
                } else {
                    resultDiv.textContent = `å›ç­”é”™è¯¯ï¼Œä½ çš„ç­”æ¡ˆæ˜¯ ${userLetters}`;
                    resultDiv.style.color = 'var(--wrong-color)';
                    // ç­”é”™æ—¶æ˜¾ç¤ºç­”æ¡ˆå’Œè§£æ
                    document.getElementById('practice-wrong-answer-container').classList.remove('hidden');
                    document.getElementById('practice-wrong-explanation-container').classList.remove('hidden');
                }

                // å¦‚æœè¿ç»­ç­”å¯¹3æ¬¡ï¼Œä»é”™é¢˜åº“ä¸­ç§»é™¤
                if (isCorrect) {
                    const correctCount = this.getCorrectCount(currentQuestion.originalIndex);
                    if (correctCount >= 3) {
                        setTimeout(() => {
                            this.removeFromPracticeWrongQuestions(currentQuestion.originalIndex);
                            // åˆ·æ–°ä¾§è¾¹æ 
                            this.updatePracticeWrongSidebar();
                        }, 1000);
                    } else {
                        // å³ä½¿æ²¡æœ‰ç§»é™¤ï¼Œä¹Ÿè¦åˆ·æ–°ä¾§è¾¹æ æ˜¾ç¤ºçŠ¶æ€
                        this.updatePracticeWrongSidebar();
                    }
                } else {
                    // ç­”é”™æ—¶ä¹Ÿè¦åˆ·æ–°ä¾§è¾¹æ 
                    this.updatePracticeWrongSidebar();
                }
            },

            // æ›´æ–°ç»ƒä¹ é”™é¢˜åº“é€‰é¡¹æ ·å¼
            updatePracticeWrongOptionStyles() {
                const question = this.getCurrentPracticeWrongQuestion();
                const library = this.getCurrentLibrary();
                const userAnswer = library.userAnswers[question.originalIndex];
                const practiceWrongMultiAnswer = this.data.practiceWrongMultiSelectAnswers[this.data.practiceWrongCurrentIndex];
                const options = document.querySelectorAll('#practice-wrong-options .option');

                options.forEach(option => {
                    option.classList.remove('correct-answer', 'wrong-answer', 'selected');
                    const letter = option.querySelector('.option-letter').textContent.trim();

                    // èƒŒé¢˜æ¨¡å¼æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ
                    if (this.data.practiceWrongMode === 'back') {
                        // åˆ¤æ–­é¢˜ç‰¹æ®Šå¤„ç†
                        if (question.ç±»å‹ === 'åˆ¤æ–­') {
                            if ((question.ç­”æ¡ˆ === 'å¯¹' && letter === 'A') ||
                                (question.ç­”æ¡ˆ === 'é”™' && letter === 'B')) {
                                option.classList.add('correct-answer');
                            }
                        } else {
                            if (question.ç­”æ¡ˆ.includes(letter)) {
                                option.classList.add('correct-answer');
                            }
                        }
                        return;
                    }

                    // ç»ƒä¹ æ¨¡å¼æ˜¾ç¤ºç”¨æˆ·ç­”æ¡ˆ
                    if (userAnswer?.isSubmitted) {
                        // æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆï¼ˆç»¿è‰²ï¼‰
                        if (question.ç±»å‹ === 'åˆ¤æ–­') {
                            if ((question.ç­”æ¡ˆ === 'å¯¹' && letter === 'A') ||
                                (question.ç­”æ¡ˆ === 'é”™' && letter === 'B')) {
                                option.classList.add('correct-answer');
                            }
                        } else {
                            if (question.ç­”æ¡ˆ.includes(letter)) {
                                option.classList.add('correct-answer');
                            }
                        }

                        let userSelected = userAnswer.selected;
                        // å¯¹äºåˆ¤æ–­é¢˜ï¼Œéœ€è¦è½¬æ¢é€‰é¡¹
                        if (question.ç±»å‹ === 'åˆ¤æ–­') {
                            if (userSelected === 'å¯¹') userSelected = 'A';
                            else if (userSelected === 'é”™') userSelected = 'B';
                        }

                        if (Array.isArray(userSelected)) {
                            if (userSelected.includes(letter) && !question.ç­”æ¡ˆ.includes(letter)) {
                                option.classList.add('wrong-answer');
                            }
                        } else {
                            if (userSelected === letter && !question.ç­”æ¡ˆ.includes(letter)) {
                                option.classList.add('wrong-answer');
                            }
                        }
                    } else {
                        // å¤šé€‰é¢˜æœªæäº¤æ—¶çš„é€‰ä¸­çŠ¶æ€
                        if (question.ç±»å‹ === 'å¤šé€‰' && practiceWrongMultiAnswer) {
                            if (practiceWrongMultiAnswer.selected.includes(letter)) {
                                option.classList.add('selected');
                            }
                        } else if (userAnswer?.selected?.includes(letter)) {
                            option.classList.add('selected');
                        }
                    }
                });
            },

            // æ¸²æŸ“è€ƒè¯•é”™é¢˜åº“é¢˜ç›® - ä¿®å¤åçš„é€»è¾‘
            renderExamWrongQuestion() {
                const question = this.getCurrentExamWrongQuestion();
                const optionsContainer = document.getElementById('exam-wrong-options');
                optionsContainer.innerHTML = '';

                const questionElement = document.getElementById('exam-wrong-question');

                // æ·»åŠ éš¾åº¦æ ‡ç­¾
                let difficultyTag = '';
                if (question.éš¾åº¦) {
                    let difficultyClass = '';
                    if (question.éš¾åº¦ === 'ç®€å•') difficultyClass = 'difficulty-easy';
                    else if (question.éš¾åº¦ === 'ä¸­ç­‰') difficultyClass = 'difficulty-medium';
                    else if (question.éš¾åº¦ === 'å›°éš¾') difficultyClass = 'difficulty-hard';

                    difficultyTag = `<span class="difficulty-tag ${difficultyClass}">${question.éš¾åº¦}</span>`;
                }

                questionElement.innerHTML = `
                    ${question.é¢˜å¹² || 'æš‚æ— é¢˜ç›®'}
                    <span class="question-type">${question.ç±»å‹ || 'æœªçŸ¥'}</span>
                    ${difficultyTag}
                    ${question.åˆ†å€¼ ? `<span class="question-type">${question.åˆ†å€¼}åˆ†</span>` : ''}
                `;

                // æ›´æ–°é€‰é¡¹å­—æ¯ï¼Œæ”¯æŒA-H
                const optionLetters = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'];
                const isJudgement = question.ç±»å‹ === 'åˆ¤æ–­';

                // æ›´æ–°æ¨¡å¼æŒ‰é’®æ–‡æœ¬
                document.getElementById('exam-wrong-modeButton').textContent =
                    this.data.examWrongMode === 'practice' ? 'åˆ‡æ¢åˆ°èƒŒé¢˜æ¨¡å¼' : 'åˆ‡æ¢åˆ°ç»ƒä¹ æ¨¡å¼';

                // åˆ¤æ–­é¢˜ç‰¹æ®Šå¤„ç†
                if (isJudgement) {
                    const optionTrue = document.createElement('button');
                    optionTrue.className = 'option';
                    optionTrue.innerHTML = `
                        <span class="option-letter">A</span>
                        <span class="option-text">å¯¹</span>
                    `;

                    const optionFalse = document.createElement('button');
                    optionFalse.className = 'option';
                    optionFalse.innerHTML = `
                        <span class="option-letter">B</span>
                        <span class="option-text">é”™</span>
                    `;

                    if (this.data.examWrongMode === 'back') {
                        optionTrue.classList.add('back-mode-option');
                        optionFalse.classList.add('back-mode-option');
                        if (question.ç­”æ¡ˆ === 'å¯¹') {
                            optionTrue.classList.add('correct-answer');
                        } else if (question.ç­”æ¡ˆ === 'é”™') {
                            optionFalse.classList.add('correct-answer');
                        }
                    } else {
                        optionTrue.addEventListener('click', () => this.selectExamWrongOption('A'));
                        optionFalse.addEventListener('click', () => this.selectExamWrongOption('B'));
                    }

                    optionsContainer.appendChild(optionTrue);
                    optionsContainer.appendChild(optionFalse);
                } else {
                    // å¸¸è§„é¢˜ç›®
                    optionLetters.forEach((letter) => {
                        const optionKey = `é€‰é¡¹${letter}`;
                        if (question[optionKey]) {
                            const option = document.createElement('button');
                            option.className = 'option';
                            option.innerHTML = `
                                <span class="option-letter">${letter}</span>
                                <span class="option-text">${question[optionKey]}</span>
                            `;

                            if (this.data.examWrongMode === 'back') {
                                option.classList.add('back-mode-option');
                                if (question.ç±»å‹ === 'åˆ¤æ–­') {
                                    if ((question.ç­”æ¡ˆ === 'å¯¹' && letter === 'A') ||
                                        (question.ç­”æ¡ˆ === 'é”™' && letter === 'B')) {
                                        option.classList.add('correct-answer');
                                    }
                                } else {
                                    if (question.ç­”æ¡ˆ.includes(letter)) {
                                        option.classList.add('correct-answer');
                                    }
                                }
                            } else {
                                if (question.ç±»å‹ === 'å¤šé€‰') {
                                    option.addEventListener('click', () => this.toggleExamWrongMultiSelectOption(letter));
                                } else {
                                    option.addEventListener('click', () => this.selectExamWrongOption(letter));
                                }
                            }

                            optionsContainer.appendChild(option);
                        }
                    });
                }

                // ç»ƒä¹ æ¨¡å¼ä¸‹çš„å¤šé€‰é¢˜æäº¤æŒ‰é’®
                if (question.ç±»å‹ === 'å¤šé€‰' && this.data.examWrongMode === 'practice') {
                    const submitButton = document.createElement('button');
                    submitButton.id = 'exam-wrong-submitButton';
                    submitButton.className = 'button button-success';
                    submitButton.textContent = 'æäº¤ç­”æ¡ˆ';
                    submitButton.addEventListener('click', () => this.handleExamWrongMultiSelectSubmit());
                    optionsContainer.appendChild(submitButton);
                }

                // æ˜¾ç¤ºç­”æ¡ˆå’Œè§£æ - ä¿®å¤ï¼šç­”é”™æ—¶æ˜¾ç¤ºç­”æ¡ˆå’Œè§£æ
                const library = this.getCurrentLibrary();
                const userAnswer = library.userAnswers[question.originalIndex];

                if (this.data.examWrongMode === 'back' || (userAnswer && userAnswer.isSubmitted && !userAnswer.isCorrect)) {
                    document.getElementById('exam-wrong-answer-container').classList.remove('hidden');
                    document.getElementById('exam-wrong-explanation-container').classList.remove('hidden');

                    document.getElementById('exam-wrong-correct-answer').textContent =
                        question.ç±»å‹ === 'å¤šé€‰' ? [...question.ç­”æ¡ˆ].join(', ') : question.ç­”æ¡ˆ;
                    document.getElementById('exam-wrong-explanation').textContent = question.è§£æ || 'æš‚æ— è§£æ';
                } else {
                    document.getElementById('exam-wrong-answer-container').classList.add('hidden');
                    document.getElementById('exam-wrong-explanation-container').classList.add('hidden');
                }

                // ç»ƒä¹ æ¨¡å¼ä¸‹æ˜¾ç¤ºç”¨æˆ·ç­”æ¡ˆï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
                const resultDiv = document.getElementById('exam-wrong-answer-result');
                if (this.data.examWrongMode === 'practice') {
                    if (userAnswer && userAnswer.isSubmitted) {
                        if (Array.isArray(userAnswer.selected)) {
                            resultDiv.textContent = `ä½ çš„ç­”æ¡ˆ: ${userAnswer.selected.join(', ')}`;
                        } else {
                            resultDiv.textContent = `ä½ çš„ç­”æ¡ˆ: ${userAnswer.selected}`;
                        }
                        resultDiv.style.color = userAnswer.isCorrect ? 'var(--correct-color)' : 'var(--wrong-color)';
                    } else {
                        resultDiv.textContent = '';
                    }
                } else {
                    resultDiv.textContent = '';
                }

                // æ›´æ–°è€ƒè¯•é”™é¢˜åº“é€‰é¡¹æ ·å¼
                this.updateExamWrongOptionStyles();
            },

            // é€‰æ‹©è€ƒè¯•é”™é¢˜åº“é€‰é¡¹ - ä¿®å¤åçš„é€»è¾‘
            selectExamWrongOption(optionLetter) {
                if (this.data.examWrongMode !== 'practice') return;

                const currentQuestion = this.getCurrentExamWrongQuestion();
                const library = this.getCurrentLibrary();

                // å¤„ç†åˆ¤æ–­é¢˜
                let processedOption = optionLetter;
                if (currentQuestion.ç±»å‹ === 'åˆ¤æ–­') {
                    if (optionLetter === 'A') processedOption = 'å¯¹';
                    else if (optionLetter === 'B') processedOption = 'é”™';
                }

                // ä¸ºå•é€‰å’Œåˆ¤æ–­ç«‹å³æ ‡è®°æäº¤çŠ¶æ€
                if (currentQuestion.ç±»å‹ === 'å•é€‰' || currentQuestion.ç±»å‹ === 'åˆ¤æ–­') {
                    const isCorrect = processedOption === currentQuestion.ç­”æ¡ˆ;

                    // è®°å½•ç­”é¢˜æ¬¡æ•°
                    this.recordQuestionPractice(currentQuestion.originalIndex, isCorrect);

                    // æ›´æ–°ç”¨æˆ·ç­”æ¡ˆ - è¿™é‡Œæ›´æ–°çš„æ˜¯åŸå§‹é¢˜åº“çš„ç”¨æˆ·ç­”æ¡ˆ
                    library.userAnswers[currentQuestion.originalIndex] = {
                        selected: processedOption,
                        isCorrect: isCorrect,
                        isSubmitted: true
                    };

                    this.saveToStorage();
                    this.updateExamWrongOptionStyles();

                    // æ˜¾ç¤ºç­”é¢˜ç»“æœ
                    const resultDiv = document.getElementById('exam-wrong-answer-result');
                    if (isCorrect) {
                        resultDiv.textContent = 'å›ç­”æ­£ç¡®';
                        resultDiv.style.color = 'var(--correct-color)';
                    } else {
                        resultDiv.textContent = `å›ç­”é”™è¯¯ï¼Œä½ çš„ç­”æ¡ˆæ˜¯ ${processedOption}`;
                        resultDiv.style.color = 'var(--wrong-color)';
                        // ç­”é”™æ—¶æ˜¾ç¤ºç­”æ¡ˆå’Œè§£æ
                        document.getElementById('exam-wrong-answer-container').classList.remove('hidden');
                        document.getElementById('exam-wrong-explanation-container').classList.remove('hidden');
                    }

                    // å¦‚æœè¿ç»­ç­”å¯¹3æ¬¡ï¼Œä»é”™é¢˜åº“ä¸­ç§»é™¤
                    if (isCorrect) {
                        const correctCount = this.getCorrectCount(currentQuestion.originalIndex);
                        if (correctCount >= 3) {
                            setTimeout(() => {
                                this.removeFromExamWrongQuestions(currentQuestion.originalIndex);
                                // åˆ·æ–°ä¾§è¾¹æ 
                                this.updateExamWrongSidebar();
                            }, 1000);
                        } else {
                            // å³ä½¿æ²¡æœ‰ç§»é™¤ï¼Œä¹Ÿè¦åˆ·æ–°ä¾§è¾¹æ æ˜¾ç¤ºçŠ¶æ€
                            this.updateExamWrongSidebar();
                        }
                    } else {
                        // ç­”é”™æ—¶ä¹Ÿè¦åˆ·æ–°ä¾§è¾¹æ 
                        this.updateExamWrongSidebar();
                    }
                }
            },

            // è€ƒè¯•é”™é¢˜åº“å¤šé€‰é¢˜é€‰é¡¹åˆ‡æ¢
            toggleExamWrongMultiSelectOption(letter) {
                const currentQuestion = this.getCurrentExamWrongQuestion();
                if (!this.data.examWrongMultiSelectAnswers[this.data.examWrongCurrentIndex]) {
                    this.data.examWrongMultiSelectAnswers[this.data.examWrongCurrentIndex] = {
                        selected: [],
                        isSubmitted: false
                    };
                }

                let userAnswer = this.data.examWrongMultiSelectAnswers[this.data.examWrongCurrentIndex];

                if (!userAnswer.isSubmitted) {
                    const index = userAnswer.selected.indexOf(letter);
                    if (index === -1) {
                        userAnswer.selected.push(letter);
                    } else {
                        userAnswer.selected.splice(index, 1);
                    }

                    this.updateExamWrongOptionStyles();
                }
            },

            // å¤„ç†è€ƒè¯•é”™é¢˜åº“å¤šé€‰é¢˜æäº¤ - ä¿®å¤åçš„é€»è¾‘
            handleExamWrongMultiSelectSubmit() {
                const currentQuestion = this.getCurrentExamWrongQuestion();
                const library = this.getCurrentLibrary();
                let userAnswer = this.data.examWrongMultiSelectAnswers[this.data.examWrongCurrentIndex];

                if (!userAnswer || userAnswer.selected.length === 0) return;

                const correctLetters = [...currentQuestion.ç­”æ¡ˆ].sort().join('');
                const userLetters = [...userAnswer.selected].sort().join('');
                const isCorrect = correctLetters === userLetters;

                // è®°å½•ç­”é¢˜æ¬¡æ•°
                this.recordQuestionPractice(currentQuestion.originalIndex, isCorrect);

                // æ›´æ–°ç”¨æˆ·ç­”æ¡ˆ - è¿™é‡Œæ›´æ–°çš„æ˜¯åŸå§‹é¢˜åº“çš„ç”¨æˆ·ç­”æ¡ˆ
                library.userAnswers[currentQuestion.originalIndex] = {
                    selected: userAnswer.selected,
                    isCorrect: isCorrect,
                    isSubmitted: true
                };

                userAnswer.isCorrect = isCorrect;
                userAnswer.isSubmitted = true;

                this.saveToStorage();
                this.updateExamWrongOptionStyles();

                // æ˜¾ç¤ºç­”é¢˜ç»“æœ
                const resultDiv = document.getElementById('exam-wrong-answer-result');
                if (isCorrect) {
                    resultDiv.textContent = 'å›ç­”æ­£ç¡®';
                    resultDiv.style.color = 'var(--correct-color)';
                } else {
                    resultDiv.textContent = `å›ç­”é”™è¯¯ï¼Œä½ çš„ç­”æ¡ˆæ˜¯ ${userLetters}`;
                    resultDiv.style.color = 'var(--wrong-color)';
                    // ç­”é”™æ—¶æ˜¾ç¤ºç­”æ¡ˆå’Œè§£æ
                    document.getElementById('exam-wrong-answer-container').classList.remove('hidden');
                    document.getElementById('exam-wrong-explanation-container').classList.remove('hidden');
                }

                // å¦‚æœè¿ç»­ç­”å¯¹3æ¬¡ï¼Œä»é”™é¢˜åº“ä¸­ç§»é™¤
                if (isCorrect) {
                    const correctCount = this.getCorrectCount(currentQuestion.originalIndex);
                    if (correctCount >= 3) {
                        setTimeout(() => {
                            this.removeFromExamWrongQuestions(currentQuestion.originalIndex);
                            // åˆ·æ–°ä¾§è¾¹æ 
                            this.updateExamWrongSidebar();
                        }, 1000);
                    } else {
                        // å³ä½¿æ²¡æœ‰ç§»é™¤ï¼Œä¹Ÿè¦åˆ·æ–°ä¾§è¾¹æ æ˜¾ç¤ºçŠ¶æ€
                        this.updateExamWrongSidebar();
                    }
                } else {
                    // ç­”é”™æ—¶ä¹Ÿè¦åˆ·æ–°ä¾§è¾¹æ 
                    this.updateExamWrongSidebar();
                }
            },

            // æ›´æ–°è€ƒè¯•é”™é¢˜åº“é€‰é¡¹æ ·å¼ - ä¿®å¤åçš„é€»è¾‘
            updateExamWrongOptionStyles() {
                const question = this.getCurrentExamWrongQuestion();
                const library = this.getCurrentLibrary();
                const userAnswer = library.userAnswers[question.originalIndex];
                const examWrongMultiAnswer = this.data.examWrongMultiSelectAnswers[this.data.examWrongCurrentIndex];
                const options = document.querySelectorAll('#exam-wrong-options .option');

                options.forEach(option => {
                    option.classList.remove('correct-answer', 'wrong-answer', 'selected');
                    const letter = option.querySelector('.option-letter').textContent.trim();

                    // èƒŒé¢˜æ¨¡å¼æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ
                    if (this.data.examWrongMode === 'back') {
                        // åˆ¤æ–­é¢˜ç‰¹æ®Šå¤„ç†
                        if (question.ç±»å‹ === 'åˆ¤æ–­') {
                            if ((question.ç­”æ¡ˆ === 'å¯¹' && letter === 'A') ||
                                (question.ç­”æ¡ˆ === 'é”™' && letter === 'B')) {
                                option.classList.add('correct-answer');
                            }
                        } else {
                            if (question.ç­”æ¡ˆ.includes(letter)) {
                                option.classList.add('correct-answer');
                            }
                        }
                        return;
                    }

                    // ç»ƒä¹ æ¨¡å¼æ˜¾ç¤ºç”¨æˆ·ç­”æ¡ˆ
                    if (userAnswer?.isSubmitted) {
                        // æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆï¼ˆç»¿è‰²ï¼‰
                        if (question.ç±»å‹ === 'åˆ¤æ–­') {
                            if ((question.ç­”æ¡ˆ === 'å¯¹' && letter === 'A') ||
                                (question.ç­”æ¡ˆ === 'é”™' && letter === 'B')) {
                                option.classList.add('correct-answer');
                            }
                        } else {
                            if (question.ç­”æ¡ˆ.includes(letter)) {
                                option.classList.add('correct-answer');
                            }
                        }

                        let userSelected = userAnswer.selected;
                        // å¯¹äºåˆ¤æ–­é¢˜ï¼Œéœ€è¦è½¬æ¢é€‰é¡¹
                        if (question.ç±»å‹ === 'åˆ¤æ–­') {
                            if (userSelected === 'å¯¹') userSelected = 'A';
                            else if (userSelected === 'é”™') userSelected = 'B';
                        }

                        if (Array.isArray(userSelected)) {
                            if (userSelected.includes(letter) && !question.ç­”æ¡ˆ.includes(letter)) {
                                option.classList.add('wrong-answer');
                            }
                        } else {
                            if (userSelected === letter && !question.ç­”æ¡ˆ.includes(letter)) {
                                option.classList.add('wrong-answer');
                            }
                        }
                    } else {
                        // å¤šé€‰é¢˜æœªæäº¤æ—¶çš„é€‰ä¸­çŠ¶æ€
                        if (question.ç±»å‹ === 'å¤šé€‰' && examWrongMultiAnswer) {
                            if (examWrongMultiAnswer.selected.includes(letter)) {
                                option.classList.add('selected');
                            }
                        } else if (userAnswer?.selected?.includes(letter)) {
                            option.classList.add('selected');
                        }
                    }
                });
            },

            // è®°å½•é¢˜ç›®ç»ƒä¹ æ¬¡æ•°
            recordQuestionPractice(questionIndex, isCorrect) {
                const key = `${this.data.currentLibraryIndex}-${questionIndex}`;

                if (!this.data.questionPracticeCounts) {
                    this.data.questionPracticeCounts = {};
                }
                if (!this.data.correctCounts) {
                    this.data.correctCounts = {};
                }

                // è®°å½•æ€»ç»ƒä¹ æ¬¡æ•°
                this.data.questionPracticeCounts[key] = (this.data.questionPracticeCounts[key] || 0) + 1;

                // è®°å½•è¿ç»­æ­£ç¡®æ¬¡æ•°
                if (isCorrect) {
                    this.data.correctCounts[key] = (this.data.correctCounts[key] || 0) + 1;
                } else {
                    this.data.correctCounts[key] = 0;
                }

                this.saveToStorage();
            },

            // è·å–è¿ç»­æ­£ç¡®æ¬¡æ•°
            getCorrectCount(questionIndex) {
                const key = `${this.data.currentLibraryIndex}-${questionIndex}`;
                return this.data.correctCounts[key] || 0;
            },

            // ä»ç»ƒä¹ é”™é¢˜åº“ä¸­ç§»é™¤é¢˜ç›®
            removeFromPracticeWrongQuestions(questionIndex) {
                const index = this.data.practiceWrongQuestions.findIndex(q => q.originalIndex === questionIndex);
                if (index !== -1) {
                    this.data.practiceWrongQuestions.splice(index, 1);
                    if (this.data.practiceWrongCurrentIndex >= this.data.practiceWrongQuestions.length) {
                        this.data.practiceWrongCurrentIndex = Math.max(0, this.data.practiceWrongQuestions.length - 1);
                    }
                    this.updatePracticeWrongUI();
                    alert('æ­¤é¢˜å·²è¿ç»­ç­”å¯¹3æ¬¡ï¼Œå·²ä»ç»ƒä¹ é”™é¢˜åº“ä¸­ç§»é™¤ï¼');
                }
            },

            // ä»è€ƒè¯•é”™é¢˜åº“ä¸­ç§»é™¤é¢˜ç›® - ä¿®å¤åçš„é€»è¾‘
            removeFromExamWrongQuestions(questionIndex) {
                const index = this.data.examWrongQuestions.findIndex(q => q.originalIndex === questionIndex);
                if (index !== -1) {
                    this.data.examWrongQuestions.splice(index, 1);
                    if (this.data.examWrongCurrentIndex >= this.data.examWrongQuestions.length) {
                        this.data.examWrongCurrentIndex = Math.max(0, this.data.examWrongQuestions.length - 1);
                    }
                    this.updateExamWrongUI();
                    alert('æ­¤é¢˜å·²è¿ç»­ç­”å¯¹3æ¬¡ï¼Œå·²ä»è€ƒè¯•é”™é¢˜åº“ä¸­ç§»é™¤ï¼');
                }
            },

            // æ¸²æŸ“ç­”æ¡ˆå’Œè§£æ
            renderAnswerAndExplanation() {
                if (this.data.examMode) return;

                const question = this.getCurrentQuestion();
                const library = this.getCurrentLibrary();
                const userAnswer = library.userAnswers[this.data.currentIndex];

                const shouldHide = this.data.mode === 'practice' &&
                    ((question.ç±»å‹ === 'å¤šé€‰' && !userAnswer?.isSubmitted) ||
                        ((question.ç±»å‹ === 'å•é€‰' || question.ç±»å‹ === 'åˆ¤æ–­') && !userAnswer));

                document.getElementById('answer-container').classList.toggle('hidden', shouldHide);
                document.getElementById('explanation-container').classList.toggle('hidden', shouldHide);

                if (!shouldHide) {
                    document.getElementById('correct-answer').textContent =
                        question.ç±»å‹ === 'å¤šé€‰' ? [...question.ç­”æ¡ˆ].join(', ') : question.ç­”æ¡ˆ;
                    document.getElementById('explanation').textContent = question.è§£æ || 'æš‚æ— è§£æ';
                }
            },

            // æ›´æ–°UI
            updateUI() {
                if (this.data.examMode) {
                    this.updateExamUI();
                } else {
                    this.updateLibraryList();
                    this.updateProgress();
                    this.updateStatusInfo();
                    this.renderQuestion();
                    this.updateButtonStates();
                    this.renderAnswerAndExplanation();
                    this.updateStatsDisplay();
                    this.updatePracticeQuestionNumberStyles();
                }
            },

            // æ›´æ–°è€ƒè¯•UI
            updateExamUI() {
                this.updateLibraryList();
                this.updateExamProgress();
                this.updateExamStatusInfo();
                this.renderQuestion();
                this.updateExamButtonStates();
                this.updateQuestionNumberStyles();
            },

            // æ›´æ–°ç»ƒä¹ é”™é¢˜åº“UI
            updatePracticeWrongUI() {
                this.updatePracticeWrongProgress();
                this.updatePracticeWrongStatusInfo();
                this.renderPracticeWrongQuestion();
                this.updatePracticeWrongButtonStates();
                this.updatePracticeWrongQuestionNumberStyles();
            },

            // æ›´æ–°è€ƒè¯•é”™é¢˜åº“UI
            updateExamWrongUI() {
                this.updateExamWrongProgress();
                this.updateExamWrongStatusInfo();
                this.renderExamWrongQuestion();
                this.updateExamWrongButtonStates();
                this.updateExamWrongQuestionNumberStyles();
            },

            // æ›´æ–°é¢˜åº“åˆ—è¡¨
            updateLibraryList() {
                const libraryList = document.getElementById('library-list');
                libraryList.innerHTML = '';

                this.data.libraries.forEach((library, index) => {
                    const libraryItem = document.createElement('div');
                    libraryItem.className = 'library-item';
                    if (index === this.data.currentLibraryIndex) {
                        libraryItem.classList.add('active');
                    }
                    libraryItem.innerHTML = `
                        ${library.name}
                        <span class="library-count">${library.questions.length}</span>
                    `;
                    libraryItem.addEventListener('click', () => this.switchLibrary(index));
                    libraryList.appendChild(libraryItem);
                });
            },

            // æ›´æ–°è¿›åº¦æ¡
            updateProgress() {
                const library = this.getCurrentLibrary();
                const totalQuestions = library.questions.length;

                const progress = totalQuestions > 0
                    ? ((this.data.currentIndex + 1) / totalQuestions) * 100
                    : 0;
                document.getElementById('progress').style.width = `${progress}%`;
            },

            // æ›´æ–°è€ƒè¯•è¿›åº¦æ¡
            updateExamProgress() {
                const progress = this.data.examQuestions.length > 0
                    ? ((this.data.currentIndex + 1) / this.data.examQuestions.length) * 100
                    : 0;
                document.getElementById('exam-progress').style.width = `${progress}%`;
            },

            // æ›´æ–°ç»ƒä¹ é”™é¢˜åº“è¿›åº¦æ¡
            updatePracticeWrongProgress() {
                const progress = this.data.practiceWrongQuestions.length > 0
                    ? ((this.data.practiceWrongCurrentIndex + 1) / this.data.practiceWrongQuestions.length) * 100
                    : 0;
                document.getElementById('practice-wrong-progress').style.width = `${progress}%`;
            },

            // æ›´æ–°è€ƒè¯•é”™é¢˜åº“è¿›åº¦æ¡
            updateExamWrongProgress() {
                const progress = this.data.examWrongQuestions.length > 0
                    ? ((this.data.examWrongCurrentIndex + 1) / this.data.examWrongQuestions.length) * 100
                    : 0;
                document.getElementById('exam-wrong-progress').style.width = `${progress}%`;
            },

            // æ›´æ–°çŠ¶æ€ä¿¡æ¯
            updateStatusInfo() {
                const library = this.getCurrentLibrary();
                const totalQuestions = library.questions.length;

                if (totalQuestions === 0) {
                    document.getElementById('status-info').textContent = 'å½“å‰é¢˜åº“æ²¡æœ‰é¢˜ç›®';
                    return;
                }

                document.getElementById('status-info').innerHTML = `
                    <span>å…± ${totalQuestions} é¢˜</span>
                    <span>ç¬¬ ${this.data.currentIndex + 1} é¢˜</span>
                    <span>${this.data.mode === 'practice' ? 'ç»ƒä¹ æ¨¡å¼' : 'èƒŒé¢˜æ¨¡å¼'}</span>
                `;
                document.getElementById('modeButton').textContent = this.data.mode === 'practice' ? 'åˆ‡æ¢åˆ°èƒŒé¢˜æ¨¡å¼' : 'åˆ‡æ¢åˆ°ç»ƒä¹ æ¨¡å¼';
            },

            // æ›´æ–°è€ƒè¯•çŠ¶æ€ä¿¡æ¯
            updateExamStatusInfo() {
                if (this.data.examQuestions.length === 0) {
                    document.getElementById('exam-status-info').textContent = 'å½“å‰é¢˜åº“æ²¡æœ‰è¶³å¤Ÿé¢˜ç›®ç”Ÿæˆè€ƒè¯•';
                    return;
                }

                const questionType = this.data.currentIndex < 100 ? 'å•é€‰é¢˜' :
                    this.data.currentIndex < 120 ? 'å¤šé€‰é¢˜' : 'åˆ¤æ–­é¢˜';

                document.getElementById('exam-status-info').innerHTML = `
                    <span>å…± 150 é¢˜</span>
                    <span>ç¬¬ ${this.data.currentIndex + 1} é¢˜ (${questionType})</span>
                    <span>è€ƒè¯•æ¨¡å¼</span>
                `;
            },

            // æ›´æ–°ç»ƒä¹ é”™é¢˜åº“çŠ¶æ€ä¿¡æ¯
            updatePracticeWrongStatusInfo() {
                if (this.data.practiceWrongQuestions.length === 0) {
                    document.getElementById('practice-wrong-status-info').textContent = 'å½“å‰æ²¡æœ‰ç»ƒä¹ é”™é¢˜';
                    return;
                }

                document.getElementById('practice-wrong-status-info').innerHTML = `
                    <span>å…± ${this.data.practiceWrongQuestions.length} é¢˜</span>
                    <span>ç¬¬ ${this.data.practiceWrongCurrentIndex + 1} é¢˜</span>
                    <span>${this.data.practiceWrongMode === 'practice' ? 'ç»ƒä¹ æ¨¡å¼' : 'èƒŒé¢˜æ¨¡å¼'}</span>
                `;
            },

            // æ›´æ–°è€ƒè¯•é”™é¢˜åº“çŠ¶æ€ä¿¡æ¯
            updateExamWrongStatusInfo() {
                if (this.data.examWrongQuestions.length === 0) {
                    document.getElementById('exam-wrong-status-info').textContent = 'å½“å‰æ²¡æœ‰è€ƒè¯•é”™é¢˜';
                    return;
                }

                document.getElementById('exam-wrong-status-info').innerHTML = `
                    <span>å…± ${this.data.examWrongQuestions.length} é¢˜</span>
                    <span>ç¬¬ ${this.data.examWrongCurrentIndex + 1} é¢˜</span>
                    <span>${this.data.examWrongMode === 'practice' ? 'ç»ƒä¹ æ¨¡å¼' : 'èƒŒé¢˜æ¨¡å¼'}</span>
                `;
            },

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            updateButtonStates() {
                const library = this.getCurrentLibrary();
                const totalQuestions = library.questions.length;

                const hasQuestions = totalQuestions > 0;

                document.getElementById('prevButton').disabled = this.data.currentIndex === 0 || !hasQuestions;
                document.getElementById('nextButton').disabled =
                    this.data.currentIndex === totalQuestions - 1 || !hasQuestions;
                document.getElementById('modeButton').disabled = !hasQuestions;
            },

            // æ›´æ–°è€ƒè¯•æŒ‰é’®çŠ¶æ€
            updateExamButtonStates() {
                const hasQuestions = this.data.examQuestions.length > 0;

                document.getElementById('exam-prevButton').disabled = this.data.currentIndex === 0 || !hasQuestions;
                document.getElementById('exam-nextButton').disabled =
                    this.data.currentIndex === this.data.examQuestions.length - 1 || !hasQuestions;
            },

            // æ›´æ–°ç»ƒä¹ é”™é¢˜åº“æŒ‰é’®çŠ¶æ€
            updatePracticeWrongButtonStates() {
                const hasQuestions = this.data.practiceWrongQuestions.length > 0;

                document.getElementById('practice-wrong-prevButton').disabled = this.data.practiceWrongCurrentIndex === 0 || !hasQuestions;
                document.getElementById('practice-wrong-nextButton').disabled =
                    this.data.practiceWrongCurrentIndex === this.data.practiceWrongQuestions.length - 1 || !hasQuestions;
            },

            // æ›´æ–°è€ƒè¯•é”™é¢˜åº“æŒ‰é’®çŠ¶æ€
            updateExamWrongButtonStates() {
                const hasQuestions = this.data.examWrongQuestions.length > 0;

                document.getElementById('exam-wrong-prevButton').disabled = this.data.examWrongCurrentIndex === 0 || !hasQuestions;
                document.getElementById('exam-wrong-nextButton').disabled =
                    this.data.examWrongCurrentIndex === this.data.examWrongQuestions.length - 1 || !hasQuestions;
            },

            // é‡ç½®é¢˜åº“
            resetLibrary() {
                if (this.data.libraries.length === 0) {
                    alert('æ²¡æœ‰å¯é‡ç½®çš„é¢˜åº“');
                    return;
                }

                const currentLibrary = this.getCurrentLibrary();
                if (!currentLibrary.name || currentLibrary.questions.length === 0) {
                    alert('å½“å‰é¢˜åº“æ²¡æœ‰é¢˜ç›®å¯é‡ç½®');
                    return;
                }

                if (confirm(`ç¡®å®šè¦é‡ç½®é¢˜åº“ "${currentLibrary.name}" å—ï¼Ÿè¿™å°†æ¸…é™¤æ‰€æœ‰ç”¨æˆ·ç­”æ¡ˆã€ç»ƒä¹ é”™é¢˜åº“å’Œè€ƒè¯•é”™é¢˜åº“å¹¶æ¢å¤åˆ°åˆå§‹çŠ¶æ€ã€‚`)) {
                    const originalLibrary = JSON.parse(JSON.stringify(this.data.libraries[this.data.currentLibraryIndex]));
                    delete originalLibrary.userAnswers;
                    delete originalLibrary.originalOrder;

                    this.data.libraries[this.data.currentLibraryIndex] = {
                        name: originalLibrary.name,
                        questions: JSON.parse(JSON.stringify(originalLibrary.questions)),
                        userAnswers: {},
                        originalOrder: []
                    };

                    // é‡ç½®ç»ƒä¹ é”™é¢˜åº“
                    this.data.practiceWrongQuestions = [];
                    this.data.practiceWrongCurrentIndex = 0;

                    // é‡ç½®è€ƒè¯•é”™é¢˜åº“
                    this.data.examWrongQuestions = [];
                    this.data.examWrongCurrentIndex = 0;

                    // é‡ç½®è€ƒè¯•å†å²è®°å½•ä¸­çš„é”™é¢˜æ•°æ®
                    this.data.examHistory.forEach(record => {
                        if (record.wrongQuestions) {
                            record.wrongQuestions = [];
                        }
                    });

                    this.data.currentIndex = 0;
                    this.data.mode = 'practice';
                    this.data.isShuffled = false;

                    this.saveToStorage();
                    this.updateUI();

                    // å¦‚æœå½“å‰åœ¨é”™é¢˜åº“æ ‡ç­¾é¡µï¼Œåˆ·æ–°æ˜¾ç¤º
                    if (this.data.currentTab === 'practice-wrong') {
                        this.updatePracticeWrongQuestions();
                        this.updatePracticeWrongUI();
                    } else if (this.data.currentTab === 'exam-wrong') {
                        this.updateExamWrongQuestions();
                        this.updateExamWrongUI();
                    }

                    alert('é¢˜åº“å·²é‡ç½®ï¼ŒåŒ…æ‹¬ç»ƒä¹ é”™é¢˜åº“å’Œè€ƒè¯•é”™é¢˜åº“');
                }
            },

            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤º
            updateStatsDisplay() {
                const library = this.getCurrentLibrary();
                if (library.questions.length === 0) {
                    return;
                }

                let correctCount = 0;
                let answeredCount = 0;

                Object.values(library.userAnswers).forEach((answer) => {
                    if (answer.isSubmitted) {
                        answeredCount++;
                        if (answer.isCorrect) {
                            correctCount++;
                        }
                    }
                });

                const accuracy = answeredCount > 0 ? Math.round((correctCount / answeredCount) * 100) : 0;
            },

            // æ›´æ–°è€ƒè¯•ç»Ÿè®¡
            updateExamStats() {
                const historyList = document.getElementById('exam-history-list');
                historyList.innerHTML = '';

                if (this.data.examHistory.length === 0) {
                    historyList.innerHTML = '<p style="text-align: center; padding: 20px; color: #666;">æš‚æ— è€ƒè¯•è®°å½•</p>';
                    return;
                }

                // æ˜¾ç¤ºæœ€è¿‘5æ¬¡è€ƒè¯•è®°å½•
                const recentHistory = this.data.examHistory.slice(-5).reverse();

                recentHistory.forEach((record, index) => {
                    const recordElement = document.createElement('div');
                    recordElement.className = 'wrong-question-item';
                    recordElement.innerHTML = `
                        <div><strong>è€ƒè¯• ${recentHistory.length - index}</strong> - ${record.date}</div>
                        <div style="font-size: 0.9em; color: #666; margin-top: 5px;">
                            å¾—åˆ†: ${record.score}/100 |
                            å•é€‰: ${record.singleScore}/50 |
                            å¤šé€‰: ${record.multiScore}/20 |
                            åˆ¤æ–­: ${record.judgeScore}/30 |
                            çŠ¶æ€: ${record.isPassed ? '<span style="color:green">é€šè¿‡</span>' : '<span style="color:red">æœªé€šè¿‡</span>'}
                        </div>
                    `;
                    historyList.appendChild(recordElement);
                });
            },

            // æ›´æ–°ç»ƒä¹ é”™é¢˜åº“
            updatePracticeWrongQuestions() {
                // è¿™ä¸ªæ–¹æ³•ç°åœ¨ç”¨äºåˆå§‹åŒ–ç»ƒä¹ é”™é¢˜åº“æ•°æ®
                this.generatePracticeWrongQuestions();
            },

            // æ›´æ–°è€ƒè¯•é”™é¢˜åº“
            updateExamWrongQuestions() {
                // è¿™ä¸ªæ–¹æ³•ç°åœ¨ç”¨äºåˆå§‹åŒ–è€ƒè¯•é”™é¢˜åº“æ•°æ®
                this.generateExamWrongQuestions();
            },

            // å¼€å§‹è€ƒè¯•è®¡æ—¶å™¨
            startExamTimer() {
                this.data.examTimeLeft = 90 * 60; // 90åˆ†é’Ÿ
                this.updateExamTimerDisplay();

                this.data.examTimer = setInterval(() => {
                    this.data.examTimeLeft--;
                    this.updateExamTimerDisplay();

                    if (this.data.examTimeLeft <= 0) {
                        this.stopExamTimer();
                        alert('è€ƒè¯•æ—¶é—´å·²åˆ°ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨æäº¤è¯•å·ï¼');
                        this.submitExam();
                    }
                }, 1000);
            },

            // åœæ­¢è€ƒè¯•è®¡æ—¶å™¨
            stopExamTimer() {
                if (this.data.examTimer) {
                    clearInterval(this.data.examTimer);
                    this.data.examTimer = null;
                }
            },

            // æ›´æ–°è€ƒè¯•è®¡æ—¶å™¨æ˜¾ç¤º
            updateExamTimerDisplay() {
                const minutes = Math.floor(this.data.examTimeLeft / 60);
                const seconds = this.data.examTimeLeft % 60;
                document.getElementById('exam-timer').textContent =
                    `å‰©ä½™æ—¶é—´: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            },

            // æäº¤è€ƒè¯•
            submitExam() {
                this.stopExamTimer();

                const totalQuestions = this.data.examQuestions.length;
                const answeredQuestions = Object.keys(this.data.examAnswers).length;

                if (answeredQuestions < totalQuestions) {
                    if (!confirm(`æ‚¨è¿˜æœ‰ ${totalQuestions - answeredQuestions} é¢˜æœªä½œç­”ï¼Œç¡®å®šè¦æäº¤å—ï¼Ÿ`)) {
                        this.startExamTimer();
                        return;
                    }
                }

                let finalScore = 0;
                let singleScore = 0;
                let multiScore = 0;
                let judgeScore = 0;
                let wrongQuestions = [];

                this.data.examQuestions.forEach((question, index) => {
                    const userAnswer = this.data.examAnswers[index];
                    if (userAnswer) {
                        let isCorrect = false;

                        if (question.ç±»å‹ === 'å•é€‰' || question.ç±»å‹ === 'åˆ¤æ–­') {
                            isCorrect = userAnswer.selected === question.ç­”æ¡ˆ;
                        } else if (question.ç±»å‹ === 'å¤šé€‰') {
                            const correctLetters = [...question.ç­”æ¡ˆ].sort().join('');
                            const userLetters = [...userAnswer.selected].sort().join('');
                            isCorrect = correctLetters === userLetters;
                        }

                        if (isCorrect) {
                            const score = question.åˆ†å€¼ || this.getQuestionScore(question.ç±»å‹);
                            finalScore += score;

                            if (question.ç±»å‹ === 'å•é€‰') singleScore += score;
                            else if (question.ç±»å‹ === 'å¤šé€‰') multiScore += score;
                            else if (question.ç±»å‹ === 'åˆ¤æ–­') judgeScore += score;
                        } else {
                            // è®°å½•é”™é¢˜
                            wrongQuestions.push({
                                ...question,
                                userAnswer: userAnswer
                            });
                        }
                    }
                });

                const isPassed = finalScore >= 60;
                const resultText = isPassed ? 'æ­å–œæ‚¨é€šè¿‡è€ƒè¯•ï¼' : 'å¾ˆé—æ†¾ï¼Œæ‚¨æœªé€šè¿‡è€ƒè¯•ã€‚';

                alert(`è€ƒè¯•ç»“æŸï¼\n\n${resultText}\n\nå¾—åˆ†: ${finalScore}/100\nå•é€‰é¢˜å¾—åˆ†: ${singleScore}/50\nå¤šé€‰é¢˜å¾—åˆ†: ${multiScore}/20\nåˆ¤æ–­é¢˜å¾—åˆ†: ${judgeScore}/30\n\n${isPassed ? '&#127881; æ­å–œæ‚¨é€šè¿‡è€ƒè¯•ï¼' : '&#128532; è¯·ç»§ç»­åŠªåŠ›ï¼'}`);

                this.data.examHistory.push({
                    date: new Date().toLocaleString(),
                    score: finalScore,
                    singleScore: singleScore,
                    multiScore: multiScore,
                    judgeScore: judgeScore,
                    isPassed: isPassed,
                    wrongQuestions: wrongQuestions
                });

                this.saveToStorage();

                // è€ƒè¯•ç»“æŸååˆå§‹åŒ–è€ƒè¯•æ¨¡å¼é¢˜åº“
                this.data.examQuestions = [];
                this.data.examAnswers = {};
                this.data.examScore = 0;
                this.data.examStarted = false;

                this.exitExamMode();
                this.switchTab('practice');
                this.updateUI();
            },

            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
            loadFromStorage() {
                const savedData = localStorage.getItem('quizData');
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    this.data = { ...this.data, ...parsedData };
                }

                if (!this.data.libraries) {
                    this.data.libraries = [];
                    this.data.currentLibraryIndex = 0;
                }

                if (!this.data.examHistory) {
                    this.data.examHistory = [];
                }

                if (!this.data.questionFontSize) {
                    this.data.questionFontSize = 12;
                }

                if (!this.data.optionFontSize) {
                    this.data.optionFontSize = 12;
                }

                if (!this.data.questionOrders) {
                    this.data.questionOrders = {
                        single: 'sequential',
                        multi: 'sequential',
                        judge: 'sequential'
                    };
                }

                if (!this.data.practiceWrongMode) {
                    this.data.practiceWrongMode = 'practice';
                }

                if (!this.data.examWrongMode) {
                    this.data.examWrongMode = 'practice';
                }

                if (!this.data.questionPracticeCounts) {
                    this.data.questionPracticeCounts = {};
                }

                if (!this.data.correctCounts) {
                    this.data.correctCounts = {};
                }

                if (!this.data.practiceWrongMultiSelectAnswers) {
                    this.data.practiceWrongMultiSelectAnswers = {};
                }

                if (!this.data.examWrongMultiSelectAnswers) {
                    this.data.examWrongMultiSelectAnswers = {};
                }
            },

            // ä¿å­˜æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
            saveToStorage() {
                localStorage.setItem('quizData', JSON.stringify(this.data));
            }
        };

        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', () => {
            quizApp.init();
        });
    </script>
</body>

</html>